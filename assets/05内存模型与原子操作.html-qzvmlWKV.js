import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as c,c as l,a as n,b as s,d as e,e as o}from"./app-BGUIea1J.js";const i={},r=o(`<h1 id="å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ"><span>å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ</span></a></h1><ul><li><p>å†…å­˜æ¨¡å‹å®šä¹‰äº†å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œè¯»å†™æ“ä½œå¦‚ä½•åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å¯è§ï¼Œä»¥åŠè¿™äº›æ“ä½œåœ¨ä½•ç§é¡ºåºä¸‹æ‰§è¡Œã€‚å†…å­˜æ¨¡å‹ç¡®ä¿ç¨‹åºçš„è¡Œä¸ºåœ¨å¹¶å‘ç¯å¢ƒä¸‹æ˜¯å¯é¢„æµ‹çš„ã€‚</p></li><li><p>åŸå­æ“ä½œå³<strong>ä¸å¯åˆ†å‰²çš„æ“ä½œ</strong>ã€‚ç³»ç»Ÿçš„æ‰€æœ‰çº¿ç¨‹ï¼Œä¸å¯èƒ½è§‚å¯Ÿåˆ°åŸå­æ“ä½œå®Œæˆäº†ä¸€åŠã€‚</p></li></ul><p>æœ€åŸºç¡€çš„æ¦‚å¿µå°±æ˜¯å¦‚æ­¤ï¼Œè¿™é‡Œä¸å†è¿‡å¤šèµ˜è¿°ï¼Œåç»­è¿˜ä¼šè¯¦ç»†å±•å¼€å†…å­˜æ¨¡å‹çš„é—®é¢˜ã€‚</p><h2 id="åŸå­æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#åŸå­æ“ä½œ"><span>åŸå­æ“ä½œ</span></a></h2><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">++</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ˜¾ç„¶ï¼Œ<code>++a</code> æ˜¯éåŸå­æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å¤šçº¿ç¨‹ä¸­å¯èƒ½ä¼šè¢«å¦ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿåˆ°åªå®Œæˆä¸€åŠã€‚</p><ol><li>çº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶å¼€å§‹ä¿®æ”¹å˜é‡ <code>a</code> çš„å€¼ã€‚</li><li>çº¿ç¨‹ A å¯¹ <code>a</code> æ‰§è¡Œé€’å¢æ“ä½œï¼Œä½†è¿˜æœªå®Œæˆã€‚</li><li>åœ¨çº¿ç¨‹ A å®Œæˆé€’å¢æ“ä½œä¹‹å‰ï¼Œçº¿ç¨‹ B ä¹Ÿæ‰§è¡Œäº†é€’å¢æ“ä½œã€‚</li><li>çº¿ç¨‹ C è¯»å– <code>a</code> çš„å€¼ã€‚</li></ol>`,7),d={href:"https://zh.cppreference.com/w/cpp/language/ub",target:"_blank",rel:"noopener noreferrer"},u=o(`<p>åœ¨ä¹‹å‰çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬è®²è¿°äº†ä½¿ç”¨å¾ˆå¤šåŒæ­¥è®¾æ–½ï¼Œå¦‚äº’æ–¥é‡ï¼Œæ¥ä¿æŠ¤å…±äº«èµ„æºã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡äº’æ–¥é‡çš„ä¿æŠ¤ï¼Œå³ä½¿ <code>++a</code> æœ¬èº«ä¸æ˜¯åŸå­æ“ä½œï¼Œ<strong>é€»è¾‘ä¸Šä¹Ÿå¯è§†ä¸ºåŸå­æ“ä½œ</strong>ã€‚äº’æ–¥é‡ç¡®ä¿äº†å¯¹å…±äº«èµ„æºçš„è¯»å†™æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé¿å…äº†æ•°æ®ç«äº‰é—®é¢˜ã€‚</p>`,3),k=n("strong",null,"åŸå­ç±»å‹",-1),m=n("strong",null,"åŸå­",-1),_={href:"https://zh.cppreference.com/w/cpp/atomic/atomic",target:"_blank",rel:"noopener noreferrer"},v=n("code",null,"std::atomic",-1),b=n("h3",{id:"åŸå­ç±»å‹-std-atomic",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#åŸå­ç±»å‹-std-atomic"},[n("span",null,[s("åŸå­ç±»å‹ "),n("code",null,"std::atomic")])])],-1),g={href:"https://zh.cppreference.com/w/cpp/header/atomic",target:"_blank",rel:"noopener noreferrer"},h=n("code",null,"<atomic>",-1),f=n("em",null,[s("å®ƒä»¬å‡ ä¹éƒ½æœ‰ä¸€ä¸ª "),n("code",null,"is_lock_free()"),s(" æˆå‘˜å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯ä»¥è®©ç”¨æˆ·æŸ¥è¯¢æŸåŸå­ç±»å‹çš„æ“ä½œæ˜¯ç›´æ¥ç”¨çš„åŸå­æŒ‡ä»¤ï¼ˆè¿”å› "),n("code",null,"true"),s("ï¼‰ï¼Œè¿˜æ˜¯å†…éƒ¨ç”¨äº†é”å®ç°ï¼ˆè¿”å› "),n("code",null,"false"),s("ï¼‰ã€‚")],-1),y=n("p",null,"åŸå­æ“ä½œå¯ä»¥ä»£æ›¿äº’æ–¥é‡ï¼Œæ¥è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œä¹Ÿèƒ½å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœå®ƒçš„å†…éƒ¨ä½¿ç”¨äº’æ–¥é‡å®ç°ï¼Œé‚£ä¹ˆä¸å¯èƒ½æœ‰æ€§èƒ½çš„æå‡ã€‚",-1),w=n("code",null,"static constexpr",-1),x={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/is_always_lock_free",target:"_blank",rel:"noopener noreferrer"},q=n("code",null,"is_always_lock_free",-1),C=n("code",null,"X::is_always_lock_free",-1),T=n("code",null,"true",-1),E=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>is_always_lock_free <span class="token comment">// true æˆ– false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),O={href:"https://zh.cppreference.com/w/cpp/atomic/atomic_is_lock_free",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"ATOMIC_xxx_LOCK_FREE",-1),I=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token comment">// (C++11 èµ·)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_BOOL_LOCK_FREE</span>     <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_CHAR_LOCK_FREE</span>     <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_CHAR16_T_LOCK_FREE</span> <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_CHAR32_T_LOCK_FREE</span> <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_WCHAR_T_LOCK_FREE</span>  <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_SHORT_LOCK_FREE</span>    <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_INT_LOCK_FREE</span>      <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_LONG_LOCK_FREE</span>     <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_LLONG_LOCK_FREE</span>    <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_POINTER_LOCK_FREE</span>  <span class="token comment">/* æœªæŒ‡å®š */</span></span>
<span class="token comment">// (C++20 èµ·)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ATOMIC_CHAR8_T_LOCK_FREE</span>  <span class="token comment">/* æœªæŒ‡å®š */</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯¹äºä¸€å®š<strong>æœ‰é”</strong>çš„å†…å»ºåŸå­ç±»å‹æ˜¯ 0ï¼›</li><li>å¯¹äº<strong>æœ‰æ—¶æ— é”</strong>çš„å†…å»ºåŸå­ç±»å‹æ˜¯ 1ï¼›</li><li>å¯¹äºä¸€å®š<strong>æ— é”</strong>çš„å†…å»ºåŸå­ç±»å‹æ˜¯ 2ã€‚</li></ul><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å®æ¥å¯¹ä»£ç è¿›è¡Œç¼–è¯‘æ—¶çš„ä¼˜åŒ–å’Œæ£€æŸ¥ï¼Œä»¥ç¡®ä¿åœ¨ç‰¹å®šå¹³å°ä¸ŠåŸå­æ“ä½œçš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“æŸäº›æ“ä½œåœ¨ç›®æ ‡å¹³å°ä¸Šæ˜¯æ— é”çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚å¦‚æœè¿™äº›æ“ä½œåœ¨ç›®æ ‡å¹³å°ä¸Šæ˜¯æœ‰é”çš„ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé€‰æ‹©å…¶å®ƒåŒæ­¥æœºåˆ¶ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token comment">// æ£€æŸ¥ std::atomic&lt;int&gt; æ˜¯å¦æ€»æ˜¯æ— é”</span>
<span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>is_always_lock_free<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;å½“å‰ç¯å¢ƒ std::atomic&lt;int&gt; å§‹ç»ˆæ˜¯æ— é”&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;å½“å‰ç¯å¢ƒ std::atomic&lt;int&gt; å¹¶ä¸æ€»æ˜¯æ— é”&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä½¿ç”¨ ATOMIC_INT_LOCK_FREE å®è¿›è¡Œç¼–è¯‘æ—¶æ£€æŸ¥</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">ATOMIC_INT_LOCK_FREE <span class="token operator">==</span> <span class="token number">2</span></span></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;int ç±»å‹çš„åŸå­æ“ä½œä¸€å®šæ— é”çš„ã€‚&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">ATOMIC_INT_LOCK_FREE <span class="token operator">==</span> <span class="token number">1</span></span></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;int ç±»å‹çš„åŸå­æ“ä½œæœ‰æ—¶æ˜¯æ— é”çš„ã€‚&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;int ç±»å‹çš„åŸå­æ“ä½œä¸€å®šæœ‰é”çš„ã€‚&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),L={href:"https://godbolt.org/z/q5x7Wfd5r",target:"_blank",rel:"noopener noreferrer"},z=o("<p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ C++17 çš„é™æ€æ•°æ®æˆå‘˜ <code>is_always_lock_free</code> å’Œé¢„å¤„ç†å®æ¥è®©ç¨‹åºæ‰§è¡Œä¸åŒçš„ä»£ç ã€‚</p><p>å› ä¸º <code>is_always_lock_free</code> æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ C++17 å¼•å…¥çš„ <code>constexpr if</code> ï¼Œå®ƒå¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œå†³ç­–ï¼Œé¿å…äº†è¿è¡Œæ—¶çš„åˆ¤æ–­å¼€é”€ï¼Œæé«˜äº†æ€§èƒ½ã€‚</p><p>å®åˆ™æ›´æ˜¯ç®€å•äº†ï¼Œæœ€åŸºæœ¬çš„é¢„å¤„ç†å™¨åˆ¤æ–­ï¼Œåœ¨é¢„å¤„ç†é˜¶æ®µå°±é€‰æ‹©æ‰§è¡Œåˆé€‚çš„ä»£ç ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„åŸå­æ“ä½œæ€»æ˜¯æ— é”çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¾å¿ƒåœ°åœ¨æ€§èƒ½å…³é”®çš„ä»£ç è·¯å¾„ä¸­ä½¿ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œåœ¨é«˜é¢‘äº¤æ˜“ç³»ç»Ÿã€å®æ—¶ç³»ç»Ÿæˆ–è€…å…¶å®ƒéœ€è¦é«˜å¹¶å‘æ€§èƒ½çš„åœºæ™¯ä¸­ï¼Œæ— é”çš„åŸå­æ“ä½œå¯ä»¥æ˜¾è‘—å‡å°‘é”çš„å¼€é”€å’Œäº‰ç”¨ï¼Œæé«˜ç³»ç»Ÿçš„ååé‡å’Œå“åº”æ—¶é—´ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå‘ç°æŸäº›åŸå­ç±»å‹åœ¨ç›®æ ‡å¹³å°ä¸Šæ˜¯æœ‰é”çš„ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–ç­–ç•¥ï¼š</p><ol><li><strong>ä½¿ç”¨ä¸åŒçš„æ•°æ®ç»“æ„</strong>ï¼šæœ‰æ—¶å¯ä»¥é€šè¿‡æ”¹å˜æ•°æ®ç»“æ„æ¥é¿å…å¯¹åŸå­æ“ä½œçš„ä¾èµ–ã€‚</li><li><strong>å‡å°‘åŸå­æ“ä½œçš„é¢‘ç‡</strong>ï¼šé€šè¿‡æ‰¹å¤„ç†ç­‰æŠ€æœ¯ï¼Œå‡å°‘å¯¹åŸå­æ“ä½œçš„è°ƒç”¨æ¬¡æ•°ã€‚</li><li><strong>ä½¿ç”¨æ›´é«˜æ•ˆçš„åŒæ­¥æœºåˆ¶</strong>ï¼šåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå…¶å®ƒåŒæ­¥æœºåˆ¶ï¼ˆå¦‚è¯»å†™é”ï¼‰å¯èƒ½æ¯”åŸå­æ“ä½œæ›´é«˜æ•ˆã€‚</li></ol><hr>",7),M=n("code",null,"std::atomic",-1),R={href:"https://github.com/microsoft/STL/blob/daeb0a6/stl/inc/atomic#L2745-L2805",target:"_blank",rel:"noopener noreferrer"},F=o(`<p>å¯¹äºæ ‡å‡†å†…å»ºç±»å‹çš„åˆ«åï¼Œå°±æ˜¯åœ¨åŸå­ç±»å‹çš„ç±»å‹åå‰é¢åŠ ä¸Š <code>atomic_</code> çš„å‰ç¼€ï¼š<code>atomic_T</code>ã€‚ä¸è¿‡ <code>signed</code> ç¼©å†™ <code>s</code>ã€<code>unsigned</code> ç¼©å†™ <code>u</code>ã€<code>long long</code> ç¼©å†™ <code>llong</code>ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">using</span> atomic_char   <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_schar  <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">signed</span> <span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_uchar  <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_short  <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">short</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_ushort <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_int    <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_uint   <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_long   <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_ulong  <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_llong  <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> atomic_ullong <span class="token operator">=</span> atomic<span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,3),N=n("code",null,"std::atomic",-1),B={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/atomic",target:"_blank",rel:"noopener noreferrer"},K={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/operator%3D",target:"_blank",rel:"noopener noreferrer"},P={href:"https://zh.cppreference.com/w/cpp/language/function#.E5.BC.83.E7.BD.AE.E5.87.BD.E6.95.B0",target:"_blank",rel:"noopener noreferrer"},S=n("strong",null,"éšå¼è½¬æ¢",-1),D={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/operator_T",target:"_blank",rel:"noopener noreferrer"},G=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token function">atomic</span><span class="token punctuation">(</span><span class="token keyword">const</span> atomic<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
atomic<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> atomic<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token keyword">operator</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),U=n("code",null,"load()",-1),V=n("code",null,"store()",-1),H=n("code",null,"exchange()",-1),Y=n("code",null,"compare_exchange_weak()",-1),j=n("code",null,"compare_exchange_strong()",-1),W=n("code",null,"std::atomic",-1),X={href:"https://zh.cppreference.com/w/cpp/atomic/atomic#.E7.89.B9.E5.8C.96.E6.88.90.E5.91.98.E5.87.BD.E6.95.B0",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"++",-1),Q=n("code",null,"--",-1),Z=n("code",null,"+=",-1),$=n("code",null,"-=",-1),nn=n("code",null,"&=",-1),sn=n("code",null,"|=",-1),an=n("code",null,"^=",-1),en=n("code",null,"fetch_add",-1),on=n("code",null,"fetch_sub",-1),tn=n("p",null,[n("code",null,"std::atomic"),s(" ç±»æ¨¡æ¿ä¸ä»…åªèƒ½ä½¿ç”¨æ ‡å‡†åº“ä¸ºæˆ‘ä»¬å®šä¹‰çš„ç‰¹åŒ–ç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥è‡ªå®šä¹‰ç±»å‹åˆ›å»ºå¯¹åº”çš„åŸå­å¯¹è±¡ã€‚ä¸è¿‡å› ä¸ºæ˜¯é€šç”¨æ¨¡æ¿ï¼Œæ“ä½œä»…é™ "),n("code",null,"load()"),s("ã€"),n("code",null,"store()"),s("ã€"),n("code",null,"exchange()"),s("ã€"),n("code",null,"compare_exchange_weak()"),s(" ã€ "),n("code",null,"compare_exchange_strong()"),s("ï¼Œä»¥åŠä¸€ä¸ªè½¬æ¢å‡½æ•°ã€‚")],-1),pn=n("code",null,"std::atomic",-1),cn={href:"https://zh.cppreference.com/w/cpp/named_req/CopyConstructible",target:"_blank",rel:"noopener noreferrer"},ln=n("em",null,"å¯å¤åˆ¶æ„é€  (CopyConstructible)",-1),rn={href:"https://zh.cppreference.com/w/cpp/named_req/CopyAssignable",target:"_blank",rel:"noopener noreferrer"},dn=n("em",null,"å¯å¤åˆ¶èµ‹å€¼ (CopyAssignable)",-1),un={href:"https://zh.cppreference.com/w/cpp/named_req/TriviallyCopyable",target:"_blank",rel:"noopener noreferrer"},kn=n("em",null,"å¯å¹³å‡¡å¤åˆ¶ (TriviallyCopyable)",-1),mn=n("code",null,"T",-1),_n=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">trivial_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> x<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> y<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">trivial_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">trivial_type</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">float</span> b<span class="token punctuation">)</span> <span class="token operator">:</span> x<span class="token punctuation">{</span> a <span class="token punctuation">}</span><span class="token punctuation">,</span> y<span class="token punctuation">{</span> b <span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token function">trivial_type</span><span class="token punctuation">(</span><span class="token keyword">const</span> trivial_type<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

    trivial_type<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> trivial_type<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

    <span class="token operator">~</span><span class="token function">trivial_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),vn=n("code",null,"std::atomic",-1),bn={href:"https://zh.cppreference.com/w/cpp/language/static_assert",target:"_blank",rel:"noopener noreferrer"},gn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_trivially_copyable<span class="token operator">&lt;</span>trivial_type<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_copy_constructible<span class="token operator">&lt;</span>trivial_type<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_move_constructible<span class="token operator">&lt;</span>trivial_type<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_copy_assignable<span class="token operator">&lt;</span>trivial_type<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_move_assignable<span class="token operator">&lt;</span>trivial_type<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¨‹åºèƒ½é€šè¿‡ç¼–è¯‘å³ä»£è¡¨æ»¡è¶³è¦æ±‚ã€‚å¦‚æœä¸æ»¡è¶³è¦æ±‚ï¼Œé™æ€æ–­è¨€æ±‚å€¼ä¸­ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼ä¸º falseï¼Œåˆ™ç¼–è¯‘é”™è¯¯ã€‚æ˜¾ç„¶æˆ‘ä»¬çš„ç±»å‹æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ä¸€ä¸‹å®ƒï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ª std::atomic&lt;trivial_type&gt; å¯¹è±¡</span>
std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span>trivial_type<span class="token operator">&gt;</span> atomic_my_type <span class="token punctuation">{</span> trivial_type<span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20.5f</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ä½¿ç”¨ store å’Œ load æ“ä½œæ¥è®¾ç½®å’Œè·å–å€¼</span>
trivial_type new_value<span class="token punctuation">{</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40.5f</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
atomic_my_type<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>new_value<span class="token punctuation">)</span><span class="token punctuation">;</span>

trivial_type loadedValue <span class="token operator">=</span> atomic_my_type<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;x: &quot;</span> <span class="token operator">&lt;&lt;</span> loadedValue<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, y: &quot;</span> <span class="token operator">&lt;&lt;</span> loadedValue<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token comment">// ä½¿ç”¨ exchange æ“ä½œ</span>
trivial_type exchanged_value <span class="token operator">=</span> atomic_my_type<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>trivial_type<span class="token punctuation">{</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60.5f</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;äº¤æ¢å‰çš„ x: &quot;</span> <span class="token operator">&lt;&lt;</span> exchanged_value<span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, äº¤æ¢å‰çš„ y: &quot;</span> <span class="token operator">&lt;&lt;</span> exchanged_value<span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;äº¤æ¢åçš„ x: &quot;</span> <span class="token operator">&lt;&lt;</span> atomic_my_type<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, äº¤æ¢åçš„ y: &quot;</span> <span class="token operator">&lt;&lt;</span> atomic_my_type<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),hn={href:"https://godbolt.org/z/jG59c3b9M",target:"_blank",rel:"noopener noreferrer"},fn=o(`<p>æ²¡æœ‰é—®é¢˜ï¼Œä¸è¿‡å…¶å®æˆ‘ä»¬çš„ <code>trivial_type</code> ç›´æ¥æ”¹æˆï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">trivial_type</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token keyword">float</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),yn={href:"https://godbolt.org/z/ozPK1qefx",target:"_blank",rel:"noopener noreferrer"},wn=o('<p>ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œæ»¡è¶³è¦æ±‚ã€‚å…ˆå‰åªæ˜¯ä¸ºäº†å±•ç¤ºä¸€ä¸‹æ˜¾å¼å†™æ˜çš„æƒ…å†µã€‚</p><hr><p>åŸå­ç±»å‹çš„æ¯ä¸ªæ“ä½œå‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ªå†…å­˜åºå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥ç”¨æ¥æŒ‡å®šæ‰§è¡Œé¡ºåºï¼Œåœ¨åé¢çš„å†…å®¹ä¼šè¯¦ç»†è®²è¿°ï¼Œç°åœ¨åªéœ€è¦çŸ¥é“æ“ä½œåˆ†ä¸ºä¸‰ç±»ï¼š</p><ol><li><p><strong>Store æ“ä½œï¼ˆå­˜å‚¨æ“ä½œï¼‰</strong>ï¼šå¯é€‰çš„å†…å­˜åºåŒ…æ‹¬ <code>memory_order_relaxed</code>ã€<code>memory_order_release</code>ã€<code>memory_order_seq_cst</code>ã€‚</p></li><li><p><strong>Load æ“ä½œï¼ˆåŠ è½½æ“ä½œï¼‰</strong>ï¼šå¯é€‰çš„å†…å­˜åºåŒ…æ‹¬ <code>memory_order_relaxed</code>ã€<code>memory_order_consume</code>ã€<code>memory_order_acquire</code>ã€<code>memory_order_seq_cst</code>ã€‚</p></li><li><p><strong>Read-modify-writeï¼ˆè¯»-æ”¹-å†™ï¼‰æ“ä½œ</strong>ï¼šå¯é€‰çš„å†…å­˜åºåŒ…æ‹¬ <code>memory_order_relaxed</code>ã€<code>memory_order_consume</code>ã€<code>memory_order_acquire</code>ã€<code>memory_order_release</code>ã€<code>memory_order_acq_rel</code>ã€<code>memory_order_seq_cst</code>ã€‚</p></li></ol><blockquote><p>æœ¬èŠ‚ä¸»è¦å¹¿æ³›ä»‹ç» <code>std::atomic</code>ï¼Œè€Œæœªå±•å¼€å…·ä½“ä½¿ç”¨ã€‚åœ¨åç»­ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°è®¨è®ºä¸€äº›ç‰ˆæœ¬ï¼Œå¦‚ <code>std::atomic&lt;bool&gt;</code>ï¼Œå¹¶ä»‹ç»å…¶æˆå‘˜å‡½æ•°å’Œä½¿ç”¨æ–¹æ³•ã€‚</p></blockquote><h3 id="st-atomic-flag" tabindex="-1"><a class="header-anchor" href="#st-atomic-flag"><span><code>st::atomic_flag</code></span></a></h3><p><code>std::atomic_flag</code> æ˜¯æœ€ç®€å•çš„åŸå­ç±»å‹ï¼Œè¿™ä¸ªç±»å‹çš„å¯¹è±¡å¯ä»¥åœ¨ä¸¤ä¸ªçŠ¶æ€é—´åˆ‡æ¢ï¼š<strong>è®¾ç½®ï¼ˆtrueï¼‰<strong>å’Œ</strong>æ¸…é™¤ï¼ˆfalseï¼‰</strong>ã€‚å®ƒå¾ˆç®€å•ï¼Œé€šå¸¸åªæ˜¯ç”¨ä½œæ„å»ºä¸€äº›åº“è®¾æ–½ï¼Œä¸ä¼šå•ç‹¬ä½¿ç”¨æˆ–ç›´æ¥é¢å‘æ™®é€šå¼€å‘è€…ã€‚</p>',7),xn=n("code",null,"std::atomic_flag",-1),qn={href:"https://zh.cppreference.com/w/cpp/atomic/ATOMIC_FLAG_INIT",target:"_blank",rel:"noopener noreferrer"},Cn=n("code",null,"ATOMIC_FLAG_INIT",-1),Tn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic_flag f <span class="token operator">=</span> ATOMIC_FLAG_INIT<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),En=n("code",null,"C++20",-1),On=n("code",null,"std::atomic_flag",-1),An={href:"https://zh.cppreference.com/w/cpp/atomic/atomic_flag/atomic_flag",target:"_blank",rel:"noopener noreferrer"},In=n("code",null,"ATOMIC_FLAG_INIT",-1),Ln=n("code",null,"ATOMIC_FLAG_INIT",-1),zn={href:"https://github.com/microsoft/STL/blob/daeb0a6/stl/inc/atomic#L2807-L2808",target:"_blank",rel:"noopener noreferrer"},Mn=n("code",null,"MSVC STL",-1),Rn=n("code",null,"{}",-1),Fn={href:"https://github.com/gcc-mirror/gcc/blob/master/libstdc%2B%2B-v3/include/bits/atomic_base.h",target:"_blank",rel:"noopener noreferrer"},Nn=n("code",null,"libstdc++",-1),Bn={href:"https://github.com/llvm/llvm-project/blob/00e80fb/clang/lib/Headers/stdatomic.h#L169",target:"_blank",rel:"noopener noreferrer"},Kn=n("code",null,"libc++",-1),Pn=n("code",null,"{ 0 }",-1),Sn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic_flag f ATOMIC_FLAG_INIT<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>atomic_flag f2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>atomic_flag f3<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>atomic_flag f4<span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ ATOMIC_FLAG_INIT å®åªæ˜¯ä¸ºäº†ç»Ÿä¸€ï¼Œæˆ‘ä»¬çŸ¥é“å³å¯ã€‚</p><p>å½“æ ‡å¿—å¯¹è±¡å·²åˆå§‹åŒ–ï¼Œå®ƒåªèƒ½åšä¸‰ä»¶äº‹æƒ…ï¼š<strong>é”€æ¯ã€æ¸…é™¤ã€è®¾ç½®</strong>ã€‚è¿™äº›æ“ä½œå¯¹åº”çš„å‡½æ•°åˆ†åˆ«æ˜¯ï¼š</p><ol><li><strong><code>clear()</code></strong> ï¼ˆæ¸…é™¤ï¼‰ï¼šå°†æ ‡å¿—å¯¹è±¡çš„çŠ¶æ€åŸå­åœ°æ›´æ”¹ä¸ºæ¸…é™¤ï¼ˆfalseï¼‰</li><li><strong><code>test_and_set</code></strong>ï¼ˆæµ‹è¯•å¹¶è®¾ç½®ï¼‰ï¼šå°†æ ‡å¿—å¯¹è±¡çš„çŠ¶æ€åŸå­åœ°æ›´æ”¹ä¸ºè®¾ç½®ï¼ˆtrueï¼‰ï¼Œå¹¶è¿”å›å®ƒå…ˆå‰ä¿æœ‰çš„å€¼ã€‚</li><li><strong>é”€æ¯</strong>ï¼šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°è¿›è¡Œé”€æ¯æ“ä½œã€‚</li></ol><p>æ¯ä¸ªæ“ä½œéƒ½å¯ä»¥æŒ‡å®šå†…å­˜é¡ºåºã€‚<code>clear()</code> æ˜¯ä¸€ä¸ªâ€œè¯»-æ”¹-å†™â€æ“ä½œï¼Œå¯ä»¥åº”ç”¨ä»»ä½•å†…å­˜é¡ºåºã€‚é»˜è®¤çš„å†…å­˜é¡ºåºæ˜¯ <code>memory_order_seq_cst</code>ã€‚ä¾‹å¦‚ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>f<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>memory_order_release<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> r <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">test_and_set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>å°† <code>f</code> çš„çŠ¶æ€åŸå­åœ°æ›´æ”¹ä¸ºæ¸…é™¤ï¼ˆfalseï¼‰ï¼ŒæŒ‡æ˜ <code>memory_order_release</code> å†…å­˜åºã€‚</p></li><li><p>å°† <code>f</code> çš„çŠ¶æ€åŸå­åœ°æ›´æ”¹ä¸ºè®¾ç½®ï¼ˆtrueï¼‰ï¼Œå¹¶è¿”å›å®ƒå…ˆå‰ä¿æœ‰çš„å€¼ç»™ <code>r</code>ã€‚ä½¿ç”¨é»˜è®¤çš„ <code>memory_order_seq_cst</code> å†…å­˜åºã€‚</p></li></ol><blockquote><p>ä¸ç”¨ç€æ€¥ï¼Œè¿™é‡Œè¿˜ä¸æ˜¯è¯¦ç»†å±•å¼€èŠå†…å­˜åºçš„æ—¶å€™ã€‚</p></blockquote>`,8),Dn=n("code",null,"std::atomic_flag",-1),Gn={href:"https://zh.cppreference.com/w/cpp/atomic/atomic_flag/atomic_flag",target:"_blank",rel:"noopener noreferrer"},Un={href:"https://zh.cppreference.com/w/cpp/atomic/atomic_flag/operator%3D",target:"_blank",rel:"noopener noreferrer"},Vn=n("code",null,"std::atomic_flag",-1),Hn=o(`<p>æœ‰é™çš„ç‰¹æ€§ä½¿å¾— <code>std::atomic_flag</code> éå¸¸é€‚åˆç”¨ä½œåˆ¶ä½œ<strong>è‡ªæ—‹é”</strong>ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">spinlock_mutex</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>atomic_flag flag<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">spinlock_mutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">noexcept</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">.</span><span class="token function">test_and_set</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>memory_order_acquire<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        flag<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>memory_order_release<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥ç®€å•çš„ä½¿ç”¨æµ‹è¯•ä¸€ä¸‹ï¼Œå®ƒæ˜¯æœ‰æ•ˆçš„ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>spinlock_mutex m<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>spinlock_mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;ğŸ˜…ğŸ˜…&quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;â¤ï¸â¤ï¸\\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),Yn={href:"https://godbolt.org/z/T583YYTh8",target:"_blank",rel:"noopener noreferrer"},jn=o("<p>ç¨å¾®èŠä¸€ä¸‹åŸç†ï¼Œæˆ‘ä»¬çš„ <code>spinlock_mutex</code> å¯¹è±¡ä¸­å­˜å‚¨çš„ <code>flag</code> å¯¹è±¡åœ¨é»˜è®¤æ„é€ æ—¶æ˜¯æ¸…é™¤ (<code>false</code>) çŠ¶æ€ã€‚åœ¨ <code>lock()</code> å‡½æ•°ä¸­è°ƒç”¨ <code>test_and_set</code> å‡½æ•°ï¼Œå®ƒæ˜¯åŸå­çš„ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸè°ƒç”¨å¹¶å°† <code>flag</code> çš„çŠ¶æ€åŸå­åœ°æ›´æ”¹ä¸ºè®¾ç½® (<code>true</code>)ï¼Œå¹¶è¿”å›å®ƒå…ˆå‰çš„å€¼ (<code>false</code>)ã€‚æ­¤æ—¶ï¼Œè¯¥çº¿ç¨‹æˆåŠŸè·å–äº†é”ï¼Œé€€å‡ºå¾ªç¯ã€‚</p><p>å½“ <code>flag</code> å¯¹è±¡çš„çŠ¶æ€ä¸ºè®¾ç½® (<code>true</code>) æ—¶ï¼Œå…¶çº¿ç¨‹è°ƒç”¨ <code>test_and_set</code> å‡½æ•°ä¼šè¿”å› <code>true</code>ï¼Œå¯¼è‡´å®ƒä»¬ç»§ç»­åœ¨å¾ªç¯ä¸­è‡ªæ—‹ï¼Œæ— æ³•é€€å‡ºã€‚ç›´åˆ°å…ˆå‰æŒæœ‰é”çš„çº¿ç¨‹è°ƒç”¨ <code>unlock()</code> å‡½æ•°ï¼Œå°† <code>flag</code> å¯¹è±¡çš„çŠ¶æ€åŸå­åœ°æ›´æ”¹ä¸ºæ¸…é™¤ (<code>false</code>) çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¸­ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸè°ƒç”¨ <code>test_and_set</code> è¿”å› <code>false</code>ï¼Œç„¶åé€€å‡ºå¾ªç¯ï¼ŒæˆåŠŸè·å–é”ã€‚</p>",2),Wn=n("code",null,"std::atomic_flag",-1),Xn={href:"https://en.wikipedia.org/wiki/Linus_Torvalds",target:"_blank",rel:"noopener noreferrer"},Jn=n("strong",null,"Linus Torvalds",-1),Qn={href:"https://www.realworldtech.com/forum/?threadid=189711&curpostid=189723",target:"_blank",rel:"noopener noreferrer"},Zn=n("ul",null,[n("li",null,[n("strong",null,"æˆ‘å†è¯´ä¸€éï¼šä¸è¦åœ¨ç”¨æˆ·ç©ºé—´ä¸­ä½¿ç”¨è‡ªæ—‹é”ï¼Œé™¤éä½ çœŸçš„çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆã€‚è¯·æ³¨æ„ï¼Œä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆçš„å¯èƒ½æ€§åŸºæœ¬ä¸Šä¸ºé›¶ã€‚"),s(" I repeat: "),n("strong",null,"do not use spinlocks in user space, unless you actually know what you're doing"),s(". And be aware that the likelihood that you know what you are doing is basically nil.")])],-1),$n=n("p",null,[s("ç„¶åå°±æ˜¯æ¨èä½¿ç”¨ "),n("code",null,"std::mutex"),s("ã€"),n("code",null,"pthread_mutex"),s(" ï¼Œæ¯”è‡ªæ—‹å¥½çš„å¤šã€‚")],-1),ns=o(`<p><code>std::atomic_flag</code> çš„å±€é™æ€§å¤ªå¼ºï¼Œç”šè‡³ä¸èƒ½å½“æ™®é€šçš„ bool æ ‡å¿—é‚£æ ·ä½¿ç”¨ã€‚ä¸€èˆ¬æœ€å¥½ä½¿ç”¨ <code>std::atomic&lt;bool&gt;</code>ï¼Œä¸‹èŠ‚ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨å®ƒã€‚</p><h3 id="std-atomic-bool" tabindex="-1"><a class="header-anchor" href="#std-atomic-bool"><span><code>std::atomic&lt;bool&gt;</code></span></a></h3><p><code>std::atomic&lt;bool&gt;</code> æ˜¯æœ€åŸºæœ¬çš„<strong>æ•´æ•°åŸå­ç±»å‹</strong> ï¼Œå®ƒç›¸è¾ƒäº <code>std::atomic_flag</code> æä¾›äº†æ›´åŠ å®Œå–„çš„å¸ƒå°”æ ‡å¿—ã€‚è™½ç„¶åŒæ ·ä¸å¯å¤åˆ¶ä¸å¯ç§»åŠ¨ï¼Œä½†å¯ä»¥ä½¿ç”¨éåŸå­çš„ bool ç±»å‹è¿›è¡Œæ„é€ ï¼Œåˆå§‹åŒ–ä¸º true æˆ– falseï¼Œå¹¶ä¸”èƒ½ä»éåŸå­çš„ bool å¯¹è±¡èµ‹å€¼ç»™ <code>std::atomic&lt;bool&gt;</code>ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> b<span class="token punctuation">{</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,4),ss={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/operator%3D",target:"_blank",rel:"noopener noreferrer"},as=n("code",null,"operator=",-1),es=n("code",null,"b = false",-1),os=n("code",null,"bool",-1),ts=o(`<blockquote><p>è¿™ä¸ªè¡Œä¸ºä¸ä»…ä»…é€‚ç”¨äº<code>std::atomic&lt;bool&gt;</code>ï¼Œè€Œæ˜¯é€‚ç”¨äºæ‰€æœ‰<code>std::atomic</code>ç±»å‹ã€‚</p></blockquote><p>å¦‚æœåŸå­å˜é‡çš„èµ‹å€¼æ“ä½œè¿”å›äº†ä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆä¾èµ–è¿™ä¸ªç»“æœçš„ä»£ç éœ€è¦æ˜¾å¼åœ°è¿›è¡ŒåŠ è½½ï¼ˆloadï¼‰ï¼Œä»¥ç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§ã€‚ä¾‹å¦‚ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span>b <span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">auto</span><span class="token operator">&amp;</span> ref <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å‡è®¾è¿”å› atomic å¼•ç”¨</span>
<span class="token keyword">bool</span> flag <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å¿…é¡»æ˜¾å¼è°ƒç”¨ load() åŠ è½½</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿”å›éåŸå­å€¼è¿›è¡Œèµ‹å€¼ï¼Œå¯ä»¥é¿å…å¤šä½™çš„åŠ è½½ï¼ˆloadï¼‰è¿‡ç¨‹ï¼Œå¾—åˆ°å®é™…å­˜å‚¨çš„å€¼ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> b<span class="token punctuation">{</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> new_value <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// new_value å°†æ˜¯ false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>store</code> åŸå­çš„æ›¿æ¢å½“å‰å¯¹è±¡çš„å€¼ï¼Œè¿œå¥½äº <code>std::atomic_flag</code> çš„ <code>clear()</code>ã€‚<code>test_and_set()</code> ä¹Ÿå¯ä»¥æ¢ä¸ºæ›´åŠ é€šç”¨å¸¸è§çš„ <code>exchange</code>ï¼Œå®ƒå¯ä»¥åŸå­çš„ä½¿ç”¨æ–°çš„å€¼æ›¿æ¢å·²ç»å­˜å‚¨çš„å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ã€‚</p>`,6),ps=n("code",null,"std::atomic<bool>",-1),cs=n("code",null,"load()",-1),ls={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/operator_T",target:"_blank",rel:"noopener noreferrer"},is=o(`<p><code>store</code> æ˜¯ä¸€ä¸ªå­˜å‚¨æ“ä½œã€<code>load</code> æ˜¯ä¸€ä¸ª<em>åŠ è½½æ“ä½œ</em>ã€<code>exchange</code> æ˜¯ä¸€ä¸ªâ€œ<em>è¯»-æ”¹-å†™</em>â€æ“ä½œï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> b<span class="token punctuation">;</span>
<span class="token keyword">bool</span> x <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>memory_order_acquire<span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>memory_order_acq_rel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><code>std::atomic&lt;bool&gt;</code> æä¾›å¤šä¸ªâ€œ<em>è¯»-æ”¹-å†™</em>â€çš„æ“ä½œï¼Œexchange åªæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å®ƒè¿˜æä¾›äº†ä¸€ç§å­˜å‚¨æ–¹å¼ï¼š<strong>å½“å‰å€¼ä¸é¢„æœŸä¸€è‡´æ—¶ï¼Œå­˜å‚¨æ–°å€¼ã€‚</strong></p>`,4),rs={href:"https://zh.cppreference.com/w/cpp/atomic/atomic/compare_exchange",target:"_blank",rel:"noopener noreferrer"},ds=n("code",null,"compare_exchange_weak()",-1),us=n("code",null,"compare_exchang_strong()",-1),ks=o(`<p><strong>compare_exchange_weak</strong>ï¼šå°è¯•å°†åŸå­å¯¹è±¡çš„å½“å‰å€¼ä¸é¢„æœŸå€¼è¿›è¡Œ<em>æ¯”è¾ƒ</em><sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>ï¼Œå¦‚æœç›¸ç­‰åˆ™å°†å…¶æ›´æ–°ä¸ºæ–°å€¼å¹¶è¿”å› <code>true</code>ï¼›å¦åˆ™ï¼Œå°†åŸå­å¯¹è±¡çš„å€¼åŠ è½½è¿› expectedï¼ˆè¿›è¡ŒåŠ è½½æ“ä½œï¼‰å¹¶è¿”å› <code>false</code>ã€‚<strong>æ­¤æ“ä½œå¯èƒ½ä¼šç”±äºæŸäº›ç¡¬ä»¶çš„ç‰¹æ€§è€Œå‡ºç°<em>å‡å¤±è´¥</em><sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup>ï¼Œéœ€è¦åœ¨å¾ªç¯ä¸­é‡è¯•</strong>ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> expected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">.</span><span class="token function">compare_exchange_weak</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),ms={href:"https://godbolt.org/z/YToPYf3hd",target:"_blank",rel:"noopener noreferrer"},_s=n("p",null,[s("è¿”å› "),n("code",null,"false"),s(" å³ä»£è¡¨å‡ºç°äº†"),n("em",null,"å‡å¤±è´¥"),s("ï¼Œå› æ­¤éœ€è¦åœ¨å¾ªç¯ä¸­é‡è¯•ã€‚ã€‚")],-1),vs=o(`<p><strong>compare_exchange_strong</strong>ï¼šç±»ä¼¼äº <code>compare_exchange_weak</code>ï¼Œ<strong>ä½†ä¸ä¼šå‡ºç°å‡å¤±è´¥ï¼Œå› æ­¤ä¸éœ€è¦é‡è¯•</strong>ã€‚é€‚ç”¨äºéœ€è¦ç¡®ä¿æ“ä½œæˆåŠŸçš„åœºåˆã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> flag<span class="token punctuation">{</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> expected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">try_set_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°è¯•å°† flag è®¾ç½®ä¸º trueï¼Œå¦‚æœå½“å‰å€¼ä¸º false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">.</span><span class="token function">compare_exchange_strong</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;flag ä¸º falseï¼Œè®¾ä¸º trueã€‚\\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;flag ä¸º true, expected è®¾ä¸º trueã€‚\\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),bs={href:"https://godbolt.org/z/zz4q8vsoe",target:"_blank",rel:"noopener noreferrer"},gs=o("<p>å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹è¿è¡Œ <code>try_set_flag</code> å‡½æ•°ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>compare_exchange_strong</code> å°†åŸå­å¯¹è±¡ <code>flag</code> è®¾ç½®ä¸º <code>true</code>ã€‚ç¬¬äºŒä¸ªçº¿ç¨‹è°ƒç”¨ <code>compare_exchange_strong</code>ï¼Œå½“å‰åŸå­å¯¹è±¡çš„å€¼ä¸º <code>true</code>ï¼Œè€Œ <code>expected</code> ä¸º <code>false</code>ï¼Œä¸ç›¸ç­‰ï¼Œå°†åŸå­å¯¹è±¡çš„å€¼è®¾ç½®ç»™ <code>expected</code>ã€‚æ­¤æ—¶ <code>flag</code> ä¸ <code>expected</code> å‡ä¸º <code>true</code>ã€‚</p>",1),hs=o(`<p>ä¸ <code>exchange</code> çš„å¦ä¸€ä¸ªä¸åŒæ˜¯ï¼Œ<code>compare_exchange_weak</code> å’Œ <code>compare_exchange_strong</code> å…è®¸æŒ‡å®šæˆåŠŸå’Œå¤±è´¥æƒ…å†µä¸‹çš„å†…å­˜åºã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æ ¹æ®æˆåŠŸæˆ–å¤±è´¥çš„æƒ…å†µï¼Œä¸ºåŸå­æ“ä½œæŒ‡å®šä¸åŒçš„å†…å­˜åºã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>atomic<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> data<span class="token punctuation">{</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> expected <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// æˆåŠŸæ—¶çš„å†…å­˜åºä¸º memory_order_releaseï¼Œå¤±è´¥æ—¶çš„å†…å­˜åºä¸º memory_order_acquire</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">compare_exchange_weak</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>memory_order_release<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>memory_order_acquire<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ“ä½œæˆåŠŸ</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ“ä½œå¤±è´¥</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ä¸ªç®€å•çš„åŸå­ç±»å‹æ˜¯ç‰¹åŒ–çš„åŸå­æŒ‡é’ˆï¼Œå³ï¼š<strong><code>std::atomic&lt;T*&gt;</code></strong>ï¼Œä¸‹ä¸€èŠ‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><h3 id="std-atomic-t" tabindex="-1"><a class="header-anchor" href="#std-atomic-t"><span><code>std::atomic&lt;T*&gt;</code></span></a></h3><h3 id="std-atomic-std-shared-ptr" tabindex="-1"><a class="header-anchor" href="#std-atomic-std-shared-ptr"><span><code>std::atomic&lt;std::shared_ptr&gt;</code></span></a></h3><h2 id="å†…å­˜æ¬¡åº" tabindex="-1"><a class="header-anchor" href="#å†…å­˜æ¬¡åº"><span>å†…å­˜æ¬¡åº</span></a></h2><h3 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€"><span>å‰è¨€</span></a></h3><p>äº‹å®ä¸Šæˆ‘ä»¬åœ¨å‰é¢å°±ç”¨åˆ°äº†ä¸å°‘çš„å†…å­˜æ¬¡åºï¼Œåªä¸è¿‡ä¸€ç›´æ²¡è¯¦ç»†å±•å¼€è®²è§£ã€‚</p><p>åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¼ºè°ƒä¸€äº›åŸºæœ¬çš„è®¤è¯†ï¼š</p><ol><li><p><strong>å†…å­˜æ¬¡åºæ˜¯éå¸¸åº•å±‚çŸ¥è¯†</strong>ï¼šå¯¹äºæ™®é€šå¼€å‘è€…æ¥è¯´ï¼Œäº†è§£å†…å­˜æ¬¡åºå¹¶éç¡¬æ€§éœ€æ±‚ã€‚å¦‚æœæ‚¨ä¸»è¦å…³æ³¨ä¸šåŠ¡å¼€å‘ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡æœ¬èŠ‚å†…å®¹ã€‚å¦‚æœæ‚¨å¯¹å†…å­˜æ¬¡åºæ„Ÿå…´è¶£ï¼Œåˆ™éœ€è¦æ³¨æ„å…¶å¤æ‚æ€§å’Œéš¾ä»¥è§‚å¯Ÿçš„ç‰¹æ€§ï¼Œè¿™å°†ä½¿å­¦ä¹ è¿‡ç¨‹å…·æœ‰ä¸€å®šæŒ‘æˆ˜æ€§ã€‚</p></li><li><p><strong>å†…å­˜æ¬¡åºé”™è¯¯çš„ä½¿ç”¨éš¾ä»¥å¯Ÿè§‰</strong>ï¼šå³ä½¿é€šè¿‡å¤šæ¬¡ï¼ˆæ•°ä»¥ä¸‡è®¡ï¼‰è¿è¡Œä¹Ÿéš¾ä»¥å‘ç°ã€‚è¿™æ˜¯å› ä¸ºè®¸å¤šå†…å­˜æ¬¡åºé—®é¢˜æ˜¯ç”±äºæç«¯çš„ã€å°‘è§çš„æƒ…å†µä¸‹çš„ç«äº‰æ¡ä»¶å¼•èµ·çš„ï¼Œè€Œè¿™äº›æƒ…å†µå¾ˆéš¾è¢«é‡ç°ã€‚æ­¤å¤–ï¼Œå³ä½¿ç¨‹åºåœ¨æŸäº›å¹³å°ä¸Šè¿è¡Œæ­£å¸¸ï¼Œä¹Ÿä¸èƒ½ä¿è¯å®ƒåœ¨å…¶ä»–å¹³å°ä¸Šä¹Ÿèƒ½è¡¨ç°è‰¯å¥½ï¼Œå› ä¸ºä¸åŒçš„ CPU å’Œç¼–è¯‘å™¨å¯èƒ½å¯¹å†…å­˜æ“ä½œçš„é¡ºåºæœ‰ä¸åŒçš„å¤„ç†ï¼ˆä¾‹å¦‚ x86 æ¶æ„å†…å­˜æ¨¡å‹ï¼šTotal Store Order (TSO)ï¼Œæ˜¯æ¯”è¾ƒä¸¥æ ¼çš„å†…å­˜æ¨¡å‹ï¼‰ã€‚å› æ­¤ï¼Œå¼€å‘è€…å¿…é¡»ä¾èµ–è‡ªå·±çš„çŸ¥è¯†å’Œç»éªŒï¼Œä»¥åŠå¯èƒ½çš„æµ‹è¯•å’Œè°ƒè¯•æŠ€æœ¯ï¼Œæ¥å‘ç°å’Œè§£å†³å†…å­˜æ¬¡åºé”™è¯¯ã€‚</p></li></ol><p>é”™è¯¯éš¾ä»¥è¢«æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„åŸå› å…¶å®å¯ä»¥ç®€å•çš„è¯´ï¼š</p><ul><li><strong>CPU ä¸ç¼–è¯‘å™¨ä¸æ˜¯ç¥ç»ç—…ï¼Œæ²¡æœ‰<em>å¥½å¤„</em>ä¸ä¼šé—²çš„æ²¡äº‹ç»™ä½ æŒ‡ä»¤é‡æ’</strong>ã€‚</li></ul><hr>`,13),fs={href:"https://zh.cppreference.com/w/cpp/language/as_if",target:"_blank",rel:"noopener noreferrer"},ys=n("strong",null,"å¦‚åŒè§„åˆ™",-1),ws=n("li",null,[n("p",null,"CPU é‡æ’ï¼šCPU åœ¨è¿è¡Œç¨‹åºæ—¶ï¼Œä¹Ÿä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ã€‚è¿™ç§é‡æ’é€šå¸¸éµå¾ªä¸€äº›ç¡¬ä»¶å±‚é¢çš„ä¼˜åŒ–è§„åˆ™ï¼Œå¦‚å†…å­˜è®¿é—®çš„ä¼˜åŒ–ã€‚")],-1),xs=o(`<p>ä½ ä»¬å¯èƒ½è¿˜æœ‰ç–‘é—®ï¼šâ€œ<strong>å•çº¿ç¨‹èƒ½ä¸èƒ½æŒ‡ä»¤é‡æ’</strong>ï¼Ÿâ€</p><p>CPU çš„æŒ‡ä»¤é‡æ’å¿…é¡»éµå¾ªä¸€å®šçš„è§„åˆ™ï¼Œä»¥ç¡®ä¿ç¨‹åºçš„å¯è§‚å¯Ÿå‰¯ä½œç”¨ä¸å—å½±å“ã€‚å¯¹äºå•çº¿ç¨‹ç¨‹åºï¼ŒCPU ä¼šä¿è¯å¤–éƒ¨è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚å¯¹äºå¤šçº¿ç¨‹ç¨‹åºï¼Œéœ€è¦å¼€å‘è€…ä½¿ç”¨åŒæ­¥åŸè¯­æ¥æ˜¾å¼åœ°æ§åˆ¶å†…å­˜æ“ä½œçš„é¡ºåºå’Œå¯è§æ€§ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ­£ç¡®æ€§ã€‚è€Œæ ‡å‡†åº“ä¸­æä¾›çš„åŸå­å¯¹è±¡çš„åŸå­æ“ä½œï¼Œè¿˜å¯ä»¥è®¾ç½®å†…å­˜æ¬¡åºã€‚</p><p>é‚£æœ‰æ²¡æœ‰å¯èƒ½ï¼š</p><ul><li>â€œ<em>end é‡æ’åˆ° start å‰é¢äº†ï¼æŒ‡ä»¤é‡æ’äº†ï¼</em>â€</li></ul><p>è¿™ä¹Ÿå°±æ˜¯å‰é¢è¯´çš„ï¼ŒæŠŠ CPU ä¸ç¼–è¯‘å™¨å½“ç¥ç»ç—…ã€‚å„ä½å†™ä»£ç éš¾é“è¿˜è¦è€ƒè™‘ä¸‹é¢è¿™æ®µï¼Œä¼šä¸ä¼šæŒ‡ä»¤é‡æ’å¯¼è‡´å…ˆè¾“å‡º <code>end</code> å—ï¼Ÿè¿™æ˜¾ç„¶ä¸ç°å®ã€‚</p><div class="language-txt line-numbers-mode" data-ext="txt" data-title="txt"><pre class="language-txt"><code>print(&quot;start&quot;); // 1
print(&quot;end&quot;);   // 2 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ç¦æ­¢å°±æ˜¯æœ‰å¯èƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬æ— éœ€åœ¨ä¹ï¼Œ<strong>å°±ç®—çœŸçš„ CPU å°† end é‡æ’åˆ° start å‰é¢äº†ï¼Œä¹Ÿå¾—åœ¨å¯è§‚æµ‹è¡Œä¸ºå‘ç”Ÿå‰å›æº¯äº†</strong>ã€‚æ‰€ä»¥æˆ‘ä¸€ç›´åœ¨å¼ºè°ƒï¼Œè¿™äº›ä¸œè¥¿ï¼Œ<strong>æˆ‘ä»¬æ— éœ€åœ¨æ„</strong>ã€‚</p><p>å¥½äº†ï¼Œåˆ°æ­¤ï¼ŒåŸºæœ¬è®¤è¯†ä¹Ÿå°±è¶³å¤Ÿäº†ï¼Œä»¥ä¸Šçš„ç¤ºä¾‹æ›´å¤šçš„æ˜¯æ³›æŒ‡ï¼ŒçŸ¥åˆ°å…¶è¡¨è¾¾çš„æ„æ€å°±å¥½ï¼Œè¿™äº›è¿˜æ˜¯ç®€å•ç›´æ¥ä¸”ç¬¦åˆç›´è§‰çš„ã€‚</p><hr class="footnotes-sep">`,9),qs={class:"footnotes"},Cs={class:"footnotes-list"},Ts={id:"footnote1",class:"footnote-item"},Es={href:"https://zh.cppreference.com/w/cpp/string/byte/memcmp",target:"_blank",rel:"noopener noreferrer"},Os={href:"https://zh.cppreference.com/w/cpp/string/byte/memcpy",target:"_blank",rel:"noopener noreferrer"},As=n("a",{href:"#footnote-ref1",class:"footnote-backref"},"â†©ï¸",-1),Is=n("li",{id:"footnote2",class:"footnote-item"},[n("p",null,[s("æ³¨ï¼šå³ä½¿ expected ä¸åŸå­å¯¹è±¡çš„å€¼ç›¸ç­‰ï¼Œè¡¨ç°å¦‚åŒ "),n("code",null,"*this != expected"),s(),n("a",{href:"#footnote-ref2",class:"footnote-backref"},"â†©ï¸")])],-1);function Ls(zs,Ms){const a=p("ExternalLinkIcon");return c(),l("div",null,[r,n("p",null,[s("çº¿ç¨‹ C åˆ°åº•è¯»å–åˆ°å¤šå°‘ä¸ç¡®å®šï¼Œa çš„å€¼æ˜¯å¤šå°‘ä¹Ÿä¸ç¡®å®šã€‚æ˜¾ç„¶ï¼Œè¿™æ„æˆäº†æ•°æ®ç«äº‰ï¼Œå‡ºç°äº†"),n("a",d,[s("æœªå®šä¹‰è¡Œä¸º"),e(a)]),s("ã€‚")]),u,n("p",null,[s("ä¸è¿‡è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ã€‚æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€ç§"),k,s("ï¼Œå®ƒçš„æ‰€æœ‰æ“ä½œéƒ½ç›´æ¥æ˜¯"),m,s("çš„ï¼Œä¸éœ€è¦é¢å¤–çš„åŒæ­¥è®¾æ–½è¿›è¡Œä¿æŠ¤ã€‚C++11 å¼•å…¥äº†åŸå­ç±»å‹ "),n("a",_,[v,e(a)]),s("ï¼Œåœ¨ä¸‹èŠ‚æˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£ã€‚")]),b,n("p",null,[s("æ ‡å‡†åŸå­ç±»å‹å®šä¹‰åœ¨å¤´æ–‡ä»¶ "),n("a",g,[h,e(a)]),s(" ä¸­ã€‚è¿™äº›ç±»å‹çš„æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œè¯­è¨€å®šä¹‰ä¸­åªæœ‰è¿™äº›ç±»å‹çš„æ“ä½œæ˜¯åŸå­çš„ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ç”¨äº’æ–¥é‡æ¥æ¨¡æ‹ŸåŸå­æ“ä½œï¼ˆè§ä¸Šæ–‡ï¼‰ã€‚æ ‡å‡†çš„åŸå­çš„ç±»å‹å®ç°å¯èƒ½æ˜¯ï¼š"),f]),y,n("p",null,[s("åœ¨ C++17 ä¸­ï¼Œæ‰€æœ‰åŸå­ç±»å‹éƒ½æœ‰ä¸€ä¸ª "),w,s(" çš„æ•°æ®æˆå‘˜ "),n("a",x,[q,e(a)]),s(" ã€‚å¦‚æœå½“å‰ç¯å¢ƒä¸Šçš„åŸå­ç±»å‹ X æ˜¯æ— é”ç±»å‹ï¼Œé‚£ä¹ˆ "),C,s(" å°†è¿”å› "),T,s(" ã€‚ä¾‹å¦‚ï¼š")]),E,n("p",null,[s("æ ‡å‡†åº“è¿˜æä¾›äº†ä¸€ç»„å® "),n("a",O,[A,e(a)]),s(" ï¼Œåœ¨ç¼–è¯‘æ—¶å¯¹å„ç§æ•´æ•°åŸå­ç±»å‹æ˜¯å¦æ— é”è¿›è¡Œåˆ¤æ–­ã€‚")]),I,n("blockquote",null,[n("p",null,[n("a",L,[s("è¿è¡Œ"),e(a)]),s("æµ‹è¯•ã€‚")])]),z,n("p",null,[s("é™¤äº†ç›´æ¥ä½¿ç”¨ "),M,s(" æ¨¡æ¿å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸå­ç±»å‹çš„åˆ«åã€‚è¿™ä¸ªæ•°é‡éå¸¸ä¹‹å¤šï¼Œè§ "),n("a",R,[s("MSVC STL"),e(a)]),s("ã€‚")]),F,n("p",null,[s("é€šå¸¸ "),N,s(" å¯¹è±¡ä¸å¯è¿›è¡Œå¤åˆ¶ã€ç§»åŠ¨ã€èµ‹å€¼ï¼Œå› ä¸ºå®ƒä»¬çš„"),n("a",B,[s("å¤åˆ¶æ„é€ "),e(a)]),s("ä¸"),n("a",K,[s("å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦"),e(a)]),s("è¢«å®šä¹‰ä¸º"),n("a",P,[s("å¼ƒç½®"),e(a)]),s("çš„ã€‚ä¸è¿‡å¯ä»¥"),S,s("æˆå¯¹åº”çš„å†…ç½®ç±»å‹ï¼Œå› ä¸ºå®ƒæœ‰"),n("a",D,[s("è½¬æ¢å‡½æ•°"),e(a)]),s("ã€‚")]),G,n("p",null,[s("å¯ä»¥ä½¿ç”¨ "),U,s("ã€"),V,s("ã€"),H,s("ã€"),Y,s(" å’Œ "),j,s(" ç­‰æˆå‘˜å‡½æ•°å¯¹ "),W,s(" è¿›è¡Œæ“ä½œã€‚å¦‚æœæ˜¯"),n("a",X,[s("æ•´æ•°ç±»å‹"),e(a)]),s("çš„ç‰¹åŒ–ï¼Œè¿˜æ”¯æŒ "),J,s("ã€"),Q,s("ã€"),Z,s("ã€"),$,s("ã€"),nn,s("ã€"),sn,s("ã€"),an,s(" ã€"),en,s("ã€"),on,s(" ç­‰æ“ä½œæ–¹å¼ã€‚åœ¨åé¢è¯¦ç»†çš„å±•å¼€ä½¿ç”¨ã€‚")]),tn,n("p",null,[s("æ¨¡æ¿ "),pn,s(" å¯ç”¨ä»»ä½•æ»¡è¶³"),n("a",cn,[ln,e(a)]),s("åŠ"),n("a",rn,[dn,e(a)]),s("çš„"),n("a",un,[kn,e(a)]),s("ç±»å‹ "),mn,s(" å®ä¾‹åŒ–ã€‚")]),_n,n("p",null,[s("éªŒè¯è‡ªå·±çš„ç±»å‹æ˜¯å¦æ»¡è¶³ "),vn,s(" è¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨"),n("a",bn,[s("é™æ€æ–­è¨€"),e(a)]),s("ï¼š")]),gn,n("blockquote",null,[n("p",null,[n("a",hn,[s("è¿è¡Œ"),e(a)]),s("æµ‹è¯•ã€‚")])]),fn,n("blockquote",null,[n("p",null,[n("a",yn,[s("è¿è¡Œ"),e(a)]),s("æµ‹è¯•ã€‚")])]),wn,n("p",null,[s("åœ¨ C++20 ä¹‹å‰ï¼Œ"),xn,s(" ç±»å‹çš„å¯¹è±¡éœ€è¦ä»¥ "),n("a",qn,[Cn,e(a)]),s(' åˆå§‹åŒ–ï¼Œå¯ä»¥ç¡®ä¿æ­¤æ—¶å¯¹è±¡å¤„äº "æ¸…é™¤"ï¼ˆfalseï¼‰çŠ¶æ€ã€‚')]),Tn,n("p",null,[s("åœ¨ "),En,s(" ä¸­ "),On,s(" çš„é»˜è®¤"),n("a",An,[s("æ„é€ å‡½æ•°"),e(a)]),s("ä¿è¯å¯¹è±¡ä¸ºâ€œæ¸…é™¤â€ï¼ˆfalseï¼‰çŠ¶æ€ï¼Œå°±ä¸å†éœ€è¦ä½¿ç”¨ "),In,s("ã€‚")]),n("p",null,[Ln,s(" å…¶å®å¹¶ä¸æ˜¯ä»€ä¹ˆå¤æ‚çš„ä¸œè¥¿ï¼Œå®ƒåœ¨ä¸åŒçš„æ ‡å‡†åº“å®ç°ä¸­åªæ˜¯ç®€å•çš„åˆå§‹åŒ–ï¼šåœ¨ "),n("a",zn,[Mn,e(a)]),s(" å®ƒåªæ˜¯ä¸€ä¸ª "),Rn,s("ï¼Œåœ¨ "),n("a",Fn,[Nn,e(a)]),s(" ä¸ "),n("a",Bn,[Kn,e(a)]),s(" å®ƒåªæ˜¯ä¸€ä¸ª "),Pn,s("ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¿™æ ·åˆå§‹åŒ–ï¼š")]),Sn,n("p",null,[Dn,s(),n("a",Gn,[s("ä¸å¯å¤åˆ¶"),e(a)]),s("ä¸å¯ç§»åŠ¨"),n("a",Un,[s("ä¸å¯èµ‹å€¼"),e(a)]),s("ã€‚è¿™ä¸æ˜¯ "),Vn,s(" ç‰¹æœ‰çš„ï¼Œè€Œæ˜¯æ‰€æœ‰åŸå­ç±»å‹å…±æœ‰çš„å±æ€§ã€‚åŸå­ç±»å‹çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œè€Œèµ‹å€¼å’Œå¤åˆ¶æ¶‰åŠä¸¤ä¸ªå¯¹è±¡ï¼Œç ´åäº†æ“ä½œçš„åŸå­æ€§ã€‚å¤åˆ¶æ„é€ å’Œå¤åˆ¶èµ‹å€¼ä¼šå…ˆè¯»å–ç¬¬ä¸€ä¸ªå¯¹è±¡çš„å€¼ï¼Œç„¶åå†å†™å…¥å¦ä¸€ä¸ªå¯¹è±¡ã€‚å¯¹äºä¸¤ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œè¿™é‡Œå®é™…ä¸Šæœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œåˆå¹¶è¿™ä¸¤ä¸ªæ“ä½œæ— æ³•ä¿è¯å…¶åŸå­æ€§ã€‚å› æ­¤ï¼Œè¿™äº›æ“ä½œæ˜¯ä¸è¢«å…è®¸çš„ã€‚")]),Hn,n("blockquote",null,[n("p",null,[n("a",Yn,[s("è¿è¡Œ"),e(a)]),s("æµ‹è¯•ã€‚")])]),jn,n("blockquote",null,[n("p",null,[s("å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åªæ˜¯ç¨å¾®çš„è®²ä¸€ä¸‹ä½¿ç”¨ "),Wn,s(" å®ç°è‡ªæ—‹é”ã€‚ä¸è¿‡å¹¶ä¸æ¨èå„ä½åœ¨å®è·µä¸­ä½¿ç”¨å®ƒï¼Œå…·ä½“å¯å‚è§ "),n("a",Xn,[Jn,e(a)]),s(" çš„"),n("a",Qn,[s("æ–‡ç« "),e(a)]),s("ã€‚å…¶ä¸­æœ‰ä¸€æ®µè¯è¯´å¾—å¾ˆç›´æ¥ï¼š")]),Zn,$n]),ns,n("p",null,[s("ä¸è¿‡è¿™ä¸ª "),n("a",ss,[as,e(a)]),s(" ä¸åŒäºé€šå¸¸æƒ…å†µï¼Œèµ‹å€¼æ“ä½œ "),es,s(" è¿”å›ä¸€ä¸ªæ™®é€šçš„ "),os,s(" å€¼ã€‚")]),ts,n("p",null,[s("è·å– "),ps,s(" çš„å€¼æœ‰ä¸¤ç§æ–¹å¼ï¼Œè°ƒç”¨ "),cs,s(" å‡½æ•°ï¼Œæˆ–è€…"),n("a",ls,[s("éšå¼è½¬æ¢"),e(a)]),s("ã€‚")]),is,n("p",null,[s("è¿™ç§æ“ä½œå«åšâ€œæ¯”è¾ƒ/äº¤æ¢â€ï¼Œå®ƒçš„å½¢å¼è¡¨ç°ä¸º "),n("a",rs,[ds,e(a)]),s(" å’Œ "),us]),n("ul",null,[n("li",null,[ks,n("blockquote",null,[n("p",null,[n("a",ms,[s("è¿è¡Œ"),e(a)]),s("æµ‹è¯•ã€‚")])]),_s]),n("li",null,[vs,n("blockquote",null,[n("p",null,[n("a",bs,[s("è¿è¡Œ"),e(a)]),s("æµ‹è¯•ã€‚")])]),gs])]),hs,n("ul",null,[n("li",null,[n("p",null,[s("ç¼–è¯‘å™¨é‡æ’ï¼šç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä»£ç æ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥æŒ‰ç…§ä¸€å®šè§„åˆ™é‡æ–°å®‰æ’ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†ä¸ç›¸å…³çš„æŒ‡ä»¤é‡æ’ï¼Œä½¿å¾— CPU æµæ°´çº¿æ›´åŠ é«˜æ•ˆåœ°æ‰§è¡ŒæŒ‡ä»¤ã€‚ç¼–è¯‘å™¨ä¼˜åŒ–éœ€è¦éµå®ˆä¸€ä¸ªâ€œ"),n("a",fs,[ys,e(a)]),s("ï¼ˆas-if ruleï¼‰â€ï¼Œå³ä¸å¯æ”¹å˜å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ã€‚")])]),ws]),xs,n("section",qs,[n("ol",Cs,[n("li",Ts,[n("p",null,[s("æ³¨ï¼š æ¯”è¾ƒå’Œå¤åˆ¶æ˜¯é€ä½çš„ï¼ˆç±»ä¼¼ "),n("a",Es,[s("std::memcmp"),e(a)]),s(" å’Œ "),n("a",Os,[s("std::memcpy"),e(a)]),s("ï¼‰ï¼›ä¸ä½¿ç”¨æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦æˆ–æ¯”è¾ƒè¿ç®—ç¬¦ã€‚ "),As])]),Is])])])}const Ns=t(i,[["render",Ls],["__file","05å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ.html.vue"]]),Bs=JSON.parse('{"path":"/md/05%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C.html","title":"å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"åŸå­æ“ä½œ","slug":"åŸå­æ“ä½œ","link":"#åŸå­æ“ä½œ","children":[{"level":3,"title":"åŸå­ç±»å‹ std::atomic","slug":"åŸå­ç±»å‹-std-atomic","link":"#åŸå­ç±»å‹-std-atomic","children":[]},{"level":3,"title":"st::atomic_flag","slug":"st-atomic-flag","link":"#st-atomic-flag","children":[]},{"level":3,"title":"std::atomic<bool>","slug":"std-atomic-bool","link":"#std-atomic-bool","children":[]},{"level":3,"title":"std::atomic<T*>","slug":"std-atomic-t","link":"#std-atomic-t","children":[]},{"level":3,"title":"std::atomic<std::shared_ptr>","slug":"std-atomic-std-shared-ptr","link":"#std-atomic-std-shared-ptr","children":[]}]},{"level":2,"title":"å†…å­˜æ¬¡åº","slug":"å†…å­˜æ¬¡åº","link":"#å†…å­˜æ¬¡åº","children":[{"level":3,"title":"å‰è¨€","slug":"å‰è¨€","link":"#å‰è¨€","children":[]}]}],"git":{"createdTime":1715425898000,"updatedTime":1716971842000,"contributors":[{"name":"mqç™½","email":"3326284481@qq.com","commits":13},{"name":"å½’æ•…é‡Œ","email":"3326284481@qq.com","commits":3}]},"readingTime":{"minutes":17.97,"words":5390},"filePathRelative":"md/05å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ.md","localizedDate":"2024å¹´5æœˆ11æ—¥","excerpt":"\\n<ul>\\n<li>\\n<p>å†…å­˜æ¨¡å‹å®šä¹‰äº†å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œè¯»å†™æ“ä½œå¦‚ä½•åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´å¯è§ï¼Œä»¥åŠè¿™äº›æ“ä½œåœ¨ä½•ç§é¡ºåºä¸‹æ‰§è¡Œã€‚å†…å­˜æ¨¡å‹ç¡®ä¿ç¨‹åºçš„è¡Œä¸ºåœ¨å¹¶å‘ç¯å¢ƒä¸‹æ˜¯å¯é¢„æµ‹çš„ã€‚</p>\\n</li>\\n<li>\\n<p>åŸå­æ“ä½œå³<strong>ä¸å¯åˆ†å‰²çš„æ“ä½œ</strong>ã€‚ç³»ç»Ÿçš„æ‰€æœ‰çº¿ç¨‹ï¼Œä¸å¯èƒ½è§‚å¯Ÿåˆ°åŸå­æ“ä½œå®Œæˆäº†ä¸€åŠã€‚</p>\\n</li>\\n</ul>\\n<p>æœ€åŸºç¡€çš„æ¦‚å¿µå°±æ˜¯å¦‚æ­¤ï¼Œè¿™é‡Œä¸å†è¿‡å¤šèµ˜è¿°ï¼Œåç»­è¿˜ä¼šè¯¦ç»†å±•å¼€å†…å­˜æ¨¡å‹çš„é—®é¢˜ã€‚</p>\\n<h2>åŸå­æ“ä½œ</h2>\\n<div class=\\"language-cpp\\" data-ext=\\"cpp\\" data-title=\\"cpp\\"><pre class=\\"language-cpp\\"><code><span class=\\"token keyword\\">int</span> a <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">f</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token operator\\">++</span>a<span class=\\"token punctuation\\">;</span>\\n<span class=\\"token punctuation\\">}</span>\\n</code></pre></div>"}');export{Ns as comp,Bs as data};
