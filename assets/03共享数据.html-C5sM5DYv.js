import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as e,o as l,c as u,a as n,d as a,b as s,w as i,e as o}from"./app-BGUIea1J.js";const d={},r=o(`<h1 id="å…±äº«æ•°æ®" tabindex="-1"><a class="header-anchor" href="#å…±äº«æ•°æ®"><span>å…±äº«æ•°æ®</span></a></h1><p>æœ¬ç« èŠ‚ä¸»è¦å†…å®¹ï¼š</p><ul><li><p>å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜</p></li><li><p>ä½¿ç”¨äº’æ–¥é‡ä¿æŠ¤å…±äº«æ•°æ®</p></li><li><p>ä¿æŠ¤å…±äº«æ•°æ®çš„å…¶å®ƒæ–¹æ¡ˆ</p></li></ul><p>åœ¨ä¸Šä¸€ç« å†…å®¹ï¼Œæˆ‘ä»¬å¯¹äºçº¿ç¨‹çš„åŸºæœ¬ä½¿ç”¨å’Œç®¡ç†ï¼Œå¯ä»¥è¯´å·²ç»æ¯”è¾ƒäº†è§£äº†ï¼Œç”šè‡³æ·±å…¥é˜…è¯»äº†éƒ¨åˆ†çš„ <code>std::thread</code> æºç ã€‚æ‰€ä»¥å¦‚æœä½ å¥½å¥½å­¦ä¹ äº†ä¸Šä¸€ç« ï¼Œæœ¬ç« ä¹Ÿå®Œå…¨ä¸ç”¨æ‹…å¿ƒã€‚</p><p>æˆ‘ä»¬æœ¬ç« ï¼Œå°±è¦å¼€å§‹èŠå…±äº«æ•°æ®çš„é‚£äº›äº‹ã€‚</p><h2 id="æ¡ä»¶ç«äº‰" tabindex="-1"><a class="header-anchor" href="#æ¡ä»¶ç«äº‰"><span>æ¡ä»¶ç«äº‰</span></a></h2><p>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æŠ¢ç€å®Œæˆè‡ªå·±çš„ä»»åŠ¡ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå³ä½¿ä¼šæ”¹å˜æ‰§è¡Œé¡ºåºï¼Œä¹Ÿæ˜¯è‰¯æ€§ç«äº‰ï¼Œè¿™æ˜¯æ— æ‰€è°“çš„ã€‚æ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹éƒ½è¦å¾€æ ‡å‡†è¾“å‡ºè¾“å‡ºä¸€æ®µå­—ç¬¦ï¼Œè°å…ˆè°åå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå¤ªå¤§å½±å“ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;â¤ï¸\\n&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;ğŸ˜¢\\n&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>thread t<span class="token punctuation">{</span> f <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread t2<span class="token punctuation">{</span> f2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8),k={href:"https://zh.cppreference.com/w/cpp/io/cout",target:"_blank",rel:"noopener noreferrer"},v=n("code",null,"std::cout",-1),m=n("em",null,"åŒæ­¥çš„ C++ æµä¿è¯æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆä»å¤šä¸ªçº¿ç¨‹è¾“å‡ºçš„å•ç‹¬å­—ç¬¦å¯èƒ½äº¤é”™ï¼Œä½†æ— æ•°æ®ç«äº‰ï¼‰",-1),_=o(`<p>åªæœ‰åœ¨æ¶‰åŠå¤šçº¿ç¨‹è¯»å†™ç›¸åŒå…±äº«æ•°æ®çš„æ—¶å€™ï¼Œæ‰ä¼šå¯¼è‡´â€œ<em>æ¶æ€§çš„æ¡ä»¶ç«äº‰</em>â€ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>v<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> v<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> v<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>thread t<span class="token punctuation">{</span> f <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread t2<span class="token punctuation">{</span> f2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯”å¦‚è¿™æ®µä»£ç å°±æ˜¯å…¸å‹çš„æ¶æ€§æ¡ä»¶ç«äº‰ï¼Œä¸¤ä¸ªçº¿ç¨‹å…±äº«ä¸€ä¸ª <code>vector</code>ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œä¿®æ”¹ã€‚å¯èƒ½å¯¼è‡´è®¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚ <code>f2</code> å…ˆæ‰§è¡Œï¼Œæ­¤æ—¶ <code>vector</code> è¿˜æ²¡æœ‰å…ƒç´ ï¼Œå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚åˆæˆ–è€… <code>f</code> æ‰§è¡Œäº†ä¸€åŠï¼Œè°ƒç”¨äº† <code>f2()</code>ï¼Œç­‰ç­‰ã€‚</p><p>å½“ç„¶äº†ï¼Œä¹Ÿæœ‰å¯èƒ½å…ˆæ‰§è¡Œ fï¼Œç„¶åæ‰§è¡Œ f2ï¼Œæœ€åæ‰“å°äº† 0ï¼Œç¨‹åºè€è€å®å®æ‰§è¡Œå®Œæ¯•ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬æ˜¾ç„¶ä¸èƒ½å¯„å¸Œæœ›äºè¿™ç§æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ã€‚</p>`,5),b=n("code",null,"emplace_back",-1),h={href:"https://zh.cppreference.com/w/cpp/language/memory_model#.E7.BA.BF.E7.A8.8B.E4.B8.8E.E6.95.B0.E6.8D.AE.E7.AB.9E.E4.BA.89",target:"_blank",rel:"noopener noreferrer"},g=n("em",null,"æœªå®šä¹‰çš„è¡Œä¸º",-1),f=n("code",null,"emplace_back",-1),w=n("em",null,"æœªå®šä¹‰",-1),x=n("blockquote",null,[n("p",null,[s("å½“æŸä¸ªè¡¨è¾¾å¼çš„æ±‚å€¼å†™å…¥æŸä¸ªå†…å­˜ä½ç½®ï¼Œè€Œå¦ä¸€æ±‚å€¼è¯»æˆ–ä¿®æ”¹åŒä¸€å†…å­˜ä½ç½®æ—¶ï¼Œç§°è¿™äº›"),n("strong",null,"è¡¨è¾¾å¼å†²çª"),s("ã€‚"),n("strong",null,"æ‹¥æœ‰ä¸¤ä¸ªå†²çªçš„æ±‚å€¼çš„ç¨‹åºå°±æœ‰æ•°æ®ç«äº‰"),s("ï¼Œé™¤é")]),n("ul",null,[n("li",null,"ä¸¤ä¸ªæ±‚å€¼éƒ½åœ¨åŒä¸€çº¿ç¨‹ä¸Šï¼Œæˆ–è€…åœ¨åŒä¸€ä¿¡å·å¤„ç†å‡½æ•°ä¸­æ‰§è¡Œï¼Œæˆ–"),n("li",null,"ä¸¤ä¸ªå†²çªçš„æ±‚å€¼éƒ½æ˜¯åŸå­æ“ä½œï¼ˆè§ std::atomicï¼‰ï¼Œæˆ–"),n("li",null,"ä¸€ä¸ªå†²çªçš„æ±‚å€¼å‘ç”Ÿæ—©äºâ€Šå¦ä¸€ä¸ªï¼ˆè§ std::memory_orderï¼‰")]),n("p",null,[n("strong",null,"å¦‚æœå‡ºç°æ•°æ®ç«äº‰ï¼Œé‚£ä¹ˆç¨‹åºçš„è¡Œä¸ºæœªå®šä¹‰ã€‚")])],-1),y=n("em",null,"æ•°æ®ç«äº‰",-1),E={href:"https://zh.cppreference.com/w/cpp/language/memory_model#.E7.BA.BF.E7.A8.8B.E4.B8.8E.E6.95.B0.E6.8D.AE.E7.AB.9E.E4.BA.89",target:"_blank",rel:"noopener noreferrer"},q=n("em",null,"æœªå®šä¹‰è¡Œä¸º",-1),z=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">auto</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">{</span>cnt<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread t1<span class="token punctuation">{</span>f<span class="token punctuation">}</span><span class="token punctuation">,</span> t2<span class="token punctuation">{</span>f<span class="token punctuation">}</span><span class="token punctuation">,</span> t3<span class="token punctuation">{</span>f<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// æœªå®šä¹‰è¡Œä¸º</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨äº’æ–¥é‡" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨äº’æ–¥é‡"><span>ä½¿ç”¨äº’æ–¥é‡</span></a></h2><p>äº’æ–¥é‡ï¼ˆMutexï¼‰ï¼Œåˆç§°ä¸ºäº’æ–¥é”ï¼ˆæˆ–è€…ç›´æ¥è¢«ç§°ä½œâ€œé”â€ï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨æ¥ä¿æŠ¤<strong>ä¸´ç•ŒåŒº</strong><sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>çš„ç‰¹æ®Šå¯¹è±¡ï¼Œå…¶ç›¸å½“äºå®ç°äº†ä¸€ä¸ªå…¬å…±çš„â€œ<strong>æ ‡å¿—ä½</strong>â€ã€‚å®ƒå¯ä»¥å¤„äºé”å®šï¼ˆlockedï¼‰çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥å¤„äºè§£é”ï¼ˆunlockedï¼‰çŠ¶æ€ï¼š</p><ol><li><p>å¦‚æœäº’æ–¥é‡æ˜¯é”å®šçš„ï¼Œé€šå¸¸è¯´æŸä¸ªç‰¹å®šçš„çº¿ç¨‹æ­£æŒæœ‰è¿™ä¸ªé”ã€‚</p></li><li><p>å¦‚æœæ²¡æœ‰çº¿ç¨‹æŒæœ‰è¿™ä¸ªäº’æ–¥é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªäº’æ–¥é‡å°±å¤„äºè§£é”çŠ¶æ€ã€‚</p></li></ol><hr><p>æ¦‚å¿µä»æ¥ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œç”¨ä¸€æ®µå¯¹æ¯”ä»£ç ä¸ºä½ ç›´è§‚çš„å±•ç¤ºäº’æ–¥é‡çš„ä½œç”¨ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">&gt;</span> threads<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        threads<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> thread <span class="token operator">:</span> threads<span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),B={href:"https://godbolt.org/z/93vTzcPzK",target:"_blank",rel:"noopener noreferrer"},A={href:"https://zh.cppreference.com/w/cpp/thread/mutex",target:"_blank",rel:"noopener noreferrer"},C=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mutex&gt;</span> <span class="token comment">// å¿…è¦æ ‡å¤´</span></span>
std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
    m<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>thread<span class="token operator">&gt;</span>threads<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        threads<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> thread <span class="token operator">:</span> threads<span class="token punctuation">)</span>
        thread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œå‡½æ•° <code>f</code> çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸè°ƒç”¨ <code>lock()</code> ç»™äº’æ–¥é‡ä¸Šé”ï¼Œå…¶ä»–æ‰€æœ‰çš„çº¿ç¨‹ <code>lock()</code> çš„è°ƒç”¨å°†é˜»å¡æ‰§è¡Œï¼Œç›´è‡³è·å¾—é”ã€‚ç¬¬ä¸€ä¸ªè°ƒç”¨ <code>lock()</code> çš„çº¿ç¨‹å¾—ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰§è¡Œæˆ‘ä»¬çš„ <code>std::cout</code> è¾“å‡ºè¯­å¥ï¼Œä¸ä¼šæœ‰ä»»ä½•å…¶ä»–çš„çº¿ç¨‹æ‰“æ–­è¿™ä¸ªæ“ä½œã€‚ç›´åˆ°çº¿ç¨‹æ‰§è¡Œ <code>unlock()</code>ï¼Œå°±è§£é”äº†äº’æ–¥é‡ã€‚</p><p>é‚£ä¹ˆå…¶ä»–çº¿ç¨‹æ­¤æ—¶ä¹Ÿå°±èƒ½å†æœ‰ä¸€ä¸ªæˆåŠŸè°ƒç”¨ <code>lock</code>...</p><blockquote><p>è‡³äºåˆ°åº•å“ªä¸ªçº¿ç¨‹æ‰ä¼šæˆåŠŸè°ƒç”¨ï¼Œè¿™ä¸ªæ˜¯ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å†³å®šçš„ã€‚</p></blockquote><p>çœ‹ä¸€éæè¿°å°±å¯ä»¥äº†ï¼Œç®€è€Œè¨€ä¹‹ï¼Œè¢« <code>lock()</code> å’Œ <code>unlock()</code> åŒ…å«åœ¨å…¶ä¸­çš„ä»£ç æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹çš„æ‰§è¡Œæ‰€æ‰“æ–­ã€‚</p><h3 id="std-lock-guard" tabindex="-1"><a class="header-anchor" href="#std-lock-guard"><span><code>std::lock_guard</code></span></a></h3>`,6),M=n("code",null,"lock()",-1),D=n("code",null,"unlock()",-1),T={href:"https://zh.cppreference.com/w/cpp/thread/lock_guard",target:"_blank",rel:"noopener noreferrer"},O=n("code",null,"std::lock_guard",-1),j=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span>lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),S=n("code",null,"std::lock_guard",-1),L={href:"https://github.com/microsoft/STL/blob/8dc4faadafb52e3e0a627e046b41258032d9bc6a/stl/inc/mutex#L448-L469",target:"_blank",rel:"noopener noreferrer"},X=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>_EXPORT_STD <span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Mutex</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">_NODISCARD_LOCK</span> lock_guard <span class="token punctuation">{</span> <span class="token comment">// class with destructor that unlocks a mutex</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">using</span> mutex_type <span class="token operator">=</span> _Mutex<span class="token punctuation">;</span>

    <span class="token keyword">explicit</span> <span class="token function">lock_guard</span><span class="token punctuation">(</span>_Mutex<span class="token operator">&amp;</span> _Mtx<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_MyMutex</span><span class="token punctuation">(</span>_Mtx<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// construct and lock</span>
        _MyMutex<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">lock_guard</span><span class="token punctuation">(</span>_Mutex<span class="token operator">&amp;</span> _Mtx<span class="token punctuation">,</span> adopt_lock_t<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token comment">// strengthened</span>
        <span class="token operator">:</span> <span class="token function">_MyMutex</span><span class="token punctuation">(</span>_Mtx<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// construct but don&#39;t lock</span>

    <span class="token operator">~</span><span class="token function">lock_guard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
        _MyMutex<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">lock_guard</span><span class="token punctuation">(</span><span class="token keyword">const</span> lock_guard<span class="token operator">&amp;</span><span class="token punctuation">)</span>            <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
    lock_guard<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> lock_guard<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    _Mutex<span class="token operator">&amp;</span> _MyMutex<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),F={href:"https://zh.cppreference.com/w/cpp/language/function#.E5.BC.83.E7.BD.AE.E5.87.BD.E6.95.B0",target:"_blank",rel:"noopener noreferrer"},P={href:"https://zh.cppreference.com/w/cpp/language/rule_of_three#.E4.BA.94.E4.B9.8B.E6.B3.95.E5.88.99",target:"_blank",rel:"noopener noreferrer"},V=n("p",null,"å®ƒåªä¿æœ‰ä¸€ä¸ªç§æœ‰æ•°æ®æˆå‘˜ï¼Œä¸€ä¸ªå¼•ç”¨ï¼Œç”¨æ¥å¼•ç”¨äº’æ–¥é‡ã€‚",-1),I=n("p",null,[s("æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–è¿™ä¸ªå¼•ç”¨ï¼ŒåŒæ—¶ä¸Šé”ï¼Œææ„å‡½æ•°ä¸­è§£é”ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„ "),n("code",null,"RAII"),s(" å¼çš„ç®¡ç†ã€‚")],-1),G={href:"https://zh.cppreference.com/w/cpp/thread/lock_tag_t",target:"_blank",rel:"noopener noreferrer"},R=n("code",null,"std::adopt_lock_t",-1),K=o(`<p>æ‰€ä»¥æœ‰çš„æ—¶å€™ä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›è¿™æ ·çš„ä»£ç ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//code..</span>
    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¶‰åŠå…±äº«èµ„æºçš„ä¿®æ”¹çš„ä»£ç ...</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//code..</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>{}</code> åˆ›å»ºäº†ä¸€ä¸ªå—ä½œç”¨åŸŸï¼Œé™åˆ¶äº†å¯¹è±¡ <code>lc</code> çš„ç”Ÿå­˜æœŸï¼Œè¿›å…¥ä½œç”¨åŸŸæ„é€  <code>lock_guard</code> çš„æ—¶å€™ä¸Šé”ï¼ˆlockï¼‰ï¼Œç¦»å¼€ä½œç”¨åŸŸææ„çš„æ—¶å€™è§£é”ï¼ˆunlockï¼‰ã€‚</p><ul><li>æˆ‘ä»¬è¦å°½å¯èƒ½çš„è®©äº’æ–¥é‡ä¸Šé”çš„<strong>ç²’åº¦</strong>å°ï¼Œåªç”¨æ¥ç¡®ä¿å¿…é¡»çš„å…±äº«èµ„æºçš„çº¿ç¨‹å®‰å…¨ã€‚</li></ul><blockquote><p><strong>â€œç²’åº¦â€é€šå¸¸ç”¨äºæè¿°é”å®šçš„èŒƒå›´å¤§å°ï¼Œè¾ƒå°çš„ç²’åº¦æ„å‘³ç€é”å®šçš„èŒƒå›´æ›´å°ï¼Œå› æ­¤æœ‰æ›´å¥½çš„æ€§èƒ½å’Œæ›´å°‘çš„ç«äº‰ã€‚</strong></p></blockquote><p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">add_to_list</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">numbers</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">iota</span><span class="token punctuation">(</span>numbers<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> sum <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">accumulate</span><span class="token punctuation">(</span>numbers<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> numbers<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">print_list</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> i <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> i <span class="token operator">&lt;&lt;</span> <span class="token char">&#39; &#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> list<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread t1<span class="token punctuation">{</span> add_to_list<span class="token punctuation">,</span>i<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span><span class="token function">ref</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread t2<span class="token punctuation">{</span> add_to_list<span class="token punctuation">,</span>i<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span><span class="token function">ref</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread t3<span class="token punctuation">{</span> print_list<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span><span class="token function">cref</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread t4<span class="token punctuation">{</span> print_list<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span><span class="token function">cref</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t4<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8),N={href:"https://godbolt.org/z/E3396dMxG",target:"_blank",rel:"noopener noreferrer"},W=o("<p>å…ˆçœ‹ <code>add_to_list</code>ï¼Œåªæœ‰ <code>list.push_back(sum)</code> æ¶‰åŠåˆ°äº†å¯¹å…±äº«æ•°æ®çš„ä¿®æ”¹ï¼Œéœ€è¦è¿›è¡Œä¿æŠ¤ï¼Œæˆ‘ä»¬ç”¨ <code>{}</code> åŒ…èµ·æ¥äº†ã€‚</p><p>å‡è®¾æœ‰çº¿ç¨‹ Aã€Bæ‰§è¡Œå‡½æ•° <code>add_to_list()</code> ï¼šçº¿ç¨‹ A ä¸­çš„ numbersã€sum ä¸çº¿ç¨‹ B ä¸­çš„ï¼Œä¸æ˜¯åŒä¸€ä¸ªï¼Œå¸Œæœ›å¤§å®¶åˆ†æ¸…æ¥šï¼Œè‡ªç„¶ä¸å­˜åœ¨æ•°æ®ç«äº‰ï¼Œä¹Ÿä¸éœ€è¦ä¸Šé”ã€‚çº¿ç¨‹ Aã€Bæ‰§è¡Œå®Œäº†å‰é¢æ±‚ <code>0-n</code> çš„è®¡ç®—ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åœ¨ <code>lock_guard</code> çš„æ„é€ å‡½æ•°ä¸­æˆåŠŸè°ƒç”¨ lock() ç»™äº’æ–¥é‡ä¸Šé”ã€‚å‡è®¾çº¿ç¨‹ A æˆåŠŸè°ƒç”¨ lock()ï¼Œé‚£ä¹ˆçº¿ç¨‹ B çš„ lock() è°ƒç”¨å°±é˜»å¡äº†ï¼Œå¿…é¡»ç­‰å¾…çº¿ç¨‹ A æ‰§è¡Œå®Œé‡Œé¢çš„ä»£ç ï¼Œç„¶åä½œç”¨åŸŸç»“æŸï¼Œè°ƒç”¨ <code>lock_guard</code> çš„ææ„å‡½æ•°ï¼Œè§£é” unlock()ï¼Œæ­¤æ—¶çº¿ç¨‹ B å°±å¯ä»¥è¿›å»æ‰§è¡Œäº†ï¼Œé¿å…äº†æ•°æ®ç«äº‰ï¼Œä¸å­˜åœ¨ä¸€ä¸ªå¯¹è±¡åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹ä¿®æ”¹ã€‚</p><p>å‡½æ•° <code>print_list()</code> å°±æ›´ç®€å•äº†ï¼Œæ‰“å° <code>list</code>ï¼Œç»™æ•´ä¸ªå‡½æ•°ä¸Šé”ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬çš„ä½¿ç”¨ä»£ç æ˜¯å¤šä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä¸¤ä¸ªå‡½æ•°å…±äº«äº†ä¸€ä¸ªé”ï¼Œè¿™æ ·ç¡®ä¿äº†å½“æ‰§è¡Œå‡½æ•° <code>print_list()</code> æ‰“å°çš„æ—¶å€™ï¼Œlist çš„çŠ¶æ€æ˜¯ç¡®å®šçš„ã€‚æ‰“å°å‡½æ•° <code>print_list</code> å’Œ <code>add_to_list</code> å‡½æ•°çš„ä¿®æ”¹æ“ä½œåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œã€‚<code>print_list()</code> ä¸å¯èƒ½çœ‹åˆ°æ­£åœ¨è¢«<code>add_to_list()</code> ä¿®æ”¹çš„ listã€‚</p><p>è‡³äºåˆ°åº•å“ªä¸ªå‡½æ•°å“ªä¸ªçº¿ç¨‹ä¼šå…ˆæ‰§è¡Œï¼Œæ‰§è¡Œå¤šå°‘æ¬¡ï¼Œè¿™äº›éƒ½ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦å†³å®šï¼Œä¹Ÿå®Œå…¨æœ‰å¯èƒ½<strong>è¿ç»­ 4 æ¬¡</strong>éƒ½æ˜¯æ‰§è¡Œå‡½æ•° <code>print_list</code> çš„çº¿ç¨‹æˆåŠŸè°ƒç”¨ <code>lock</code>ï¼Œä¼šæ‰“å°å‡ºäº†ä¸€æ ·çš„å€¼ï¼Œè¿™éƒ½å¾ˆæ­£å¸¸ã€‚</p><hr>",6),Y={href:"https://zh.cppreference.com/w/cpp/language/class_template_argument_deduction",target:"_blank",rel:"noopener noreferrer"},J=n("code",null,"std::lock_guard",-1),Q=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>lock_guard lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// std::lock_guard&lt;std::mutex&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Z={href:"https://zh.cppreference.com/w/cpp/thread/scoped_lock",target:"_blank",rel:"noopener noreferrer"},H=n("code",null,"std::scoped_lock",-1),U=n("code",null,"lock_guard",-1),$=n("strong",null,"å®ƒå¯ä»¥ç®¡ç†å¤šä¸ªäº’æ–¥é‡",-1),nn=n("code",null,"lock_guard",-1),sn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>scoped_lock lc<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// std::scoped_lock&lt;std::mutex&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åœ¨åç»­ç®¡ç†å¤šä¸ªäº’æ–¥é‡ï¼Œä¼šè¯¦ç»†äº†è§£è¿™ä¸ªç±»ã€‚</p><h3 id="try-lock" tabindex="-1"><a class="header-anchor" href="#try-lock"><span><code>try_lock</code></span></a></h3><p><code>try_lock</code> æ˜¯äº’æ–¥é‡ä¸­çš„ä¸€ç§å°è¯•ä¸Šé”çš„æ–¹å¼ã€‚ä¸å¸¸è§„çš„ <code>lock</code> ä¸åŒï¼Œ<code>try_lock</code> ä¼šå°è¯•ä¸Šé”ï¼Œä½†å¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™<strong>ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œè€Œæ˜¯ç«‹å³è¿”å›</strong>ã€‚</p><p>å®ƒçš„è¿”å›ç±»å‹æ˜¯ <code>bool</code> ï¼Œå¦‚æœä¸Šé”æˆåŠŸå°±è¿”å› <code>true</code>ï¼Œå¤±è´¥å°±è¿”å› <code>false</code>ã€‚</p><p>è¿™ç§æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦ä¿æŠ¤ä¸´ç•ŒåŒºçš„åŒæ—¶ï¼Œåˆä¸æƒ³çº¿ç¨‹å› ä¸ºç­‰å¾…é”è€Œé˜»å¡çš„æƒ…å†µä¸‹ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex mtx<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">thread_function</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å°è¯•åŠ é”</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mtx<span class="token punctuation">.</span><span class="token function">try_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; è·å¾—é”&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token comment">// ä¸´ç•ŒåŒºä»£ç </span>
        std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">sleep_for</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>chrono<span class="token double-colon punctuation">::</span><span class="token function">milliseconds</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¨¡æ‹Ÿä¸´ç•ŒåŒºæ“ä½œ</span>
        mtx<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£é”</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; é‡Šæ”¾é”&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;çº¿ç¨‹ï¼š&quot;</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; è·å–é”å¤±è´¥ å¤„ç†æ­¥éª¤&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹è¿è¡Œè¿™æ®µä»£ç ï¼Œå¿…ç„¶æœ‰ä¸€ä¸ªçº¿ç¨‹æ— æ³•æˆåŠŸä¸Šé”ï¼Œè¦èµ° else çš„åˆ†æ”¯ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>thread <span class="token function">t1</span><span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread <span class="token function">t2</span><span class="token punctuation">(</span>thread_function<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,9),an={href:"https://godbolt.org/z/hqW8eahWx",target:"_blank",rel:"noopener noreferrer"},tn=n("strong",null,"è¿è¡Œç»“æœ",-1),on=o(`<div class="language-txt line-numbers-mode" data-ext="txt" data-title="txt"><pre class="language-txt"><code>çº¿ç¨‹ï¼š1 è·å¾—é”
çº¿ç¨‹ï¼š2 è·å–é”å¤±è´¥ å¤„ç†æ­¥éª¤
çº¿ç¨‹ï¼š1 é‡Šæ”¾é”
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¿æŠ¤å…±äº«æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ä¿æŠ¤å…±äº«æ•°æ®"><span>ä¿æŠ¤å…±äº«æ•°æ®</span></a></h2><p>äº’æ–¥é‡ä¸»è¦ä¹Ÿå°±æ˜¯ä¸ºäº†ä¿æŠ¤å…±äº«æ•°æ®ï¼Œä¸Šä¸€èŠ‚çš„<em>ä½¿ç”¨äº’æ–¥é‡</em>ä¹Ÿå·²ç»ä¸ºå„ä½å±•ç¤ºäº†ä¸€äº›ã€‚</p><p>ç„¶è€Œä½¿ç”¨äº’æ–¥é‡æ¥ä¿æŠ¤å…±äº«æ•°æ®ä¹Ÿå¹¶ä¸æ˜¯åœ¨å‡½æ•°ä¸­åŠ ä¸Šä¸€ä¸ª <code>std::lock_guard</code> å°±ä¸‡äº‹å¤§å‰äº†ã€‚æœ‰çš„æ—¶å€™åªéœ€è¦ä¸€ä¸ªæŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œå°±èƒ½è®©è¿™ç§ä¿æŠ¤<strong>å½¢åŒè™šè®¾</strong>ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string b<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ä¿®æ”¹æ•°æ®æˆå‘˜ç­‰...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Data_wrapper</span><span class="token punctuation">{</span>
    Data data<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Func</span><span class="token operator">&gt;</span>
    <span class="token keyword">void</span> <span class="token function">process_data</span><span class="token punctuation">(</span>Func func<span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span>m<span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">func</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å—ä¿æŠ¤æ•°æ®ä¼ é€’ç»™å‡½æ•°</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Data<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">malicious_function</span><span class="token punctuation">(</span>Data<span class="token operator">&amp;</span> protected_data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    p <span class="token operator">=</span> <span class="token operator">&amp;</span>protected_data<span class="token punctuation">;</span> <span class="token comment">// å—ä¿æŠ¤çš„æ•°æ®è¢«ä¼ é€’</span>
<span class="token punctuation">}</span>

Data_wrapper d<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    d<span class="token punctuation">.</span><span class="token function">process_data</span><span class="token punctuation">(</span>malicious_function<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ é€’äº†ä¸€ä¸ªæ¶æ„çš„å‡½æ•°</span>
    p<span class="token operator">-&gt;</span><span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// åœ¨æ— ä¿æŠ¤çš„æƒ…å†µä¸‹è®¿é—®ä¿æŠ¤æ•°æ®</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆå‘˜å‡½æ•°æ¨¡æ¿ <code>process_data</code> çœ‹èµ·æ¥ä¸€ç‚¹é—®é¢˜ä¹Ÿæ²¡æœ‰ï¼Œä½¿ç”¨ <code>std::lock_guard</code> å¯¹æ•°æ®åšäº†ä¿æŠ¤ï¼Œä½†æ˜¯è°ƒç”¨æ–¹ä¼ é€’äº† <code>malicious_function</code> è¿™æ ·ä¸€ä¸ªæ¶æ„çš„å‡½æ•°ï¼Œä½¿å—ä¿æŠ¤æ•°æ®ä¼ é€’ç»™å¤–éƒ¨ï¼Œå¯ä»¥åœ¨æ²¡æœ‰è¢«äº’æ–¥é‡ä¿æŠ¤çš„æƒ…å†µä¸‹è°ƒç”¨ <code>do_something()</code>ã€‚</p><p>æˆ‘ä»¬ä¼ é€’çš„å‡½æ•°å°±ä¸è¯¥æ˜¯æ¶‰åŠå¤–éƒ¨å‰¯ä½œç”¨çš„ï¼Œå°±åº”è¯¥æ˜¯å•çº¯çš„åœ¨å—äº’æ–¥é‡ä¿æŠ¤çš„æƒ…å†µä¸‹è€è€å®å®è°ƒç”¨ <code>do_something()</code> æ“ä½œå—ä¿æŠ¤çš„æ•°æ®ã€‚</p><ul><li><em>ç®€è€Œè¨€ä¹‹ï¼š<strong>åˆ‡å‹¿å°†å—ä¿æŠ¤æ•°æ®çš„æŒ‡é’ˆæˆ–å¼•ç”¨ä¼ é€’åˆ°äº’æ–¥é‡ä½œç”¨åŸŸä¹‹å¤–</strong>ï¼Œä¸ç„¶ä¿æŠ¤å°†<strong>å½¢åŒè™šè®¾</strong>ã€‚</em></li></ul><blockquote><p><code>process_data</code> çš„ç¡®ç®—æ˜¯æ²¡é—®é¢˜ï¼Œç”¨æˆ·éè¦åšè¿™äº›äº‹æƒ…ä¹Ÿæ˜¯é˜²ä¸ä½çš„ï¼Œæˆ‘ä»¬åªæ˜¯å‘Šè¯‰å„ä½å¯èƒ½çš„æƒ…å†µã€‚</p></blockquote><h2 id="æ­»é”-é—®é¢˜ä¸è§£å†³" tabindex="-1"><a class="header-anchor" href="#æ­»é”-é—®é¢˜ä¸è§£å†³"><span>æ­»é”ï¼šé—®é¢˜ä¸è§£å†³</span></a></h2><p>è¯•æƒ³ä¸€ä¸‹ï¼Œæœ‰ä¸€ä¸ªç©å…·ï¼Œè¿™ä¸ªç©å…·æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¿…é¡»åŒæ—¶æ‹¿åˆ°ä¸¤éƒ¨åˆ†æ‰èƒ½ç©ã€‚æ¯”å¦‚ä¸€ä¸ªé¥æ§æ±½è½¦ï¼Œéœ€è¦é¥æ§å™¨å’Œç©å…·è½¦æ‰èƒ½ç©ã€‚æœ‰ä¸¤ä¸ªå°å­©ï¼Œä»–ä»¬éƒ½æƒ³ç©è¿™ä¸ªç©å…·ã€‚å½“å…¶ä¸­ä¸€ä¸ªå°å­©æ‹¿åˆ°äº†é¥æ§å™¨å’Œç©å…·è½¦æ—¶ï¼Œå°±å¯ä»¥å°½æƒ…ç©è€ã€‚å½“å¦ä¸€ä¸ªå°å­©ä¹Ÿæƒ³ç©ï¼Œä»–å°±å¾—ç­‰å¾…å¦ä¸€ä¸ªå°å­©ç©å®Œæ‰è¡Œã€‚å†è¯•æƒ³ï¼Œé¥æ§å™¨å’Œç©å…·è½¦è¢«æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼Œå¹¶ä¸”ä¸¤ä¸ªå°å­©éƒ½æƒ³è¦ç©ï¼Œå¹¶ä¸”ä¸€ä¸ªæ‹¿åˆ°äº†é¥æ§å™¨ï¼Œå¦ä¸€ä¸ªæ‹¿åˆ°äº†ç©å…·è½¦ã€‚é—®é¢˜å°±å‡ºç°äº†ï¼Œé™¤éå…¶ä¸­ä¸€ä¸ªå­©å­å†³å®šè®©å¦ä¸€ä¸ªå…ˆç©ï¼Œä»–æŠŠè‡ªå·±çš„é‚£ä¸ªéƒ¨åˆ†ç»™å¦ä¸€ä¸ªå°å­©ã€‚ä½†å¦‚æœä»–ä»¬éƒ½ä¸æ„¿æ„ï¼Œé‚£ä¹ˆè¿™ä¸ªé¥æ§æ±½è½¦å°±è°éƒ½æ²¡æœ‰åŠæ³•ç©ã€‚</p><p>æˆ‘ä»¬å½“ç„¶ä¸åœ¨ä¹å°å­©æŠ¢ç©å…·ï¼Œæˆ‘ä»¬è¦èŠçš„æ˜¯çº¿ç¨‹å¯¹é”çš„ç«äº‰ï¼š<em>ä¸¤ä¸ªçº¿ç¨‹éœ€è¦å¯¹å®ƒä»¬æ‰€æœ‰çš„äº’æ–¥é‡åšä¸€äº›æ“ä½œï¼Œå…¶ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªäº’æ–¥é‡ï¼Œä¸”ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„äº’æ–¥é‡è§£é”ã€‚å› ä¸ºå®ƒä»¬éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾äº’æ–¥é‡ï¼Œæ²¡æœ‰çº¿ç¨‹å·¥ä½œã€‚</em> è¿™ç§æƒ…å†µå°±æ˜¯æ­»é”ã€‚</p><ul><li><strong>å¤šä¸ªäº’æ–¥é‡æ‰å¯èƒ½é‡åˆ°æ­»é”é—®é¢˜</strong>ã€‚</li></ul><p>é¿å…æ­»é”çš„ä¸€èˆ¬å»ºè®®æ˜¯è®©ä¸¤ä¸ªäº’æ–¥é‡ä»¥ç›¸åŒçš„é¡ºåºä¸Šé”ï¼Œæ€»åœ¨äº’æ–¥é‡ B ä¹‹å‰é”ä½äº’æ–¥é‡ Aï¼Œå°±é€šå¸¸ä¸ä¼šæ­»é”ã€‚åé¢ç¤ºä¾‹</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m1<span class="token punctuation">,</span>m2<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>size_t n<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc1<span class="token punctuation">{</span> m1 <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc2<span class="token punctuation">{</span> m2 <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc1<span class="token punctuation">{</span> m2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lc2<span class="token punctuation">{</span> m1 <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>f</code> ä¸ <code>f2</code> å› ä¸ºäº’æ–¥é‡<strong>ä¸Šé”é¡ºåºä¸åŒ</strong>ï¼Œå°±æœ‰æ­»é”é£é™©ã€‚å‡½æ•° <code>f</code> å…ˆé”å®š <code>m1</code>ï¼Œç„¶åå†å°è¯•é”å®š <code>m2</code>ï¼Œè€Œå‡½æ•° <code>f2</code> å…ˆé”å®š <code>m2</code> å†é”å®š <code>m1</code> ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå®ƒä»¬å°±å¯èƒ½ä¼šå½¼æ­¤ç­‰å¾…å¯¹æ–¹é‡Šæ”¾å…¶æ‰€éœ€çš„é”ï¼Œä»è€Œé€ æˆæ­»é”ã€‚</p>`,16),en={href:"https://godbolt.org/z/T8vWYzqnT",target:"_blank",rel:"noopener noreferrer"},pn=o(`<hr><p>ä½†æ˜¯æœ‰çš„æ—¶å€™å³ä½¿å›ºå®šé”é¡ºåºï¼Œä¾æ—§ä¼šäº§ç”Ÿé—®é¢˜ã€‚å½“æœ‰å¤šä¸ªäº’æ–¥é‡ä¿æŠ¤åŒä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼Œå¯¹äºç›¸åŒç±»å‹çš„ä¸¤ä¸ªä¸åŒå¯¹è±¡è¿›è¡Œæ•°æ®çš„äº¤æ¢æ“ä½œï¼Œä¸ºäº†ä¿è¯æ•°æ®äº¤æ¢çš„æ­£ç¡®æ€§ï¼Œå°±è¦é¿å…å…¶å®ƒçº¿ç¨‹ä¿®æ”¹ï¼Œç¡®ä¿æ¯ä¸ªå¯¹è±¡çš„äº’æ–¥é‡éƒ½é”ä½è‡ªå·±è¦ä¿æŠ¤çš„åŒºåŸŸã€‚å¦‚æœæŒ‰ç…§å‰é¢çš„çš„é€‰æ‹©ä¸€ä¸ªå›ºå®šçš„é¡ºåºä¸Šé”è§£é”ï¼Œåˆ™æ¯«æ— æ„ä¹‰ï¼Œæ¯”å¦‚ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">struct</span> <span class="token class-name">X</span><span class="token punctuation">{</span>
    <span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token operator">:</span>object<span class="token punctuation">{</span> str <span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> X<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string object<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> X<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>lhs <span class="token operator">==</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock1<span class="token punctuation">{</span> lhs<span class="token punctuation">.</span>m <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock2<span class="token punctuation">{</span> rhs<span class="token punctuation">.</span>m <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token function">swap</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>object<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è€ƒè™‘ç”¨æˆ·è°ƒç”¨çš„æ—¶å€™å°†å‚æ•°äº¤æ¢ï¼Œå°±ä¼šäº§ç”Ÿæ­»é”</strong>ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>X a<span class="token punctuation">{</span> <span class="token string">&quot;ğŸ¤£&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> b<span class="token punctuation">{</span> <span class="token string">&quot;ğŸ˜…&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>thread t<span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span>
std<span class="token double-colon punctuation">::</span>thread t2<span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token function">swap</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>1</code> æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆä¸Šé” a çš„äº’æ–¥é‡ï¼Œå†ä¸Šé” b çš„äº’æ–¥é‡ã€‚</p><p><code>2</code> æ‰§è¡Œçš„æ—¶å€™ï¼Œå…ˆä¸Šé” b çš„äº’æ–¥é‡ï¼Œå†ä¸Šé” a çš„äº’æ–¥é‡ã€‚</p>`,7),cn=n("code",null,"2",-1),ln=n("strong",null,"æ­»é”",-1),un={href:"https://godbolt.org/z/M6hfeb778",target:"_blank",rel:"noopener noreferrer"},dn=n("p",null,"å…¶å®ä¹Ÿå°±æ˜¯å›åˆ°äº†ç¬¬ä¸€ä¸ªç¤ºä¾‹çš„é—®é¢˜ã€‚",-1),rn={href:"https://zh.cppreference.com/w/cpp/thread/lock",target:"_blank",rel:"noopener noreferrer"},kn=n("code",null,"std::lock",-1),vn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> X<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>lhs <span class="token operator">==</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">lock</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>m<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç»™ä¸¤ä¸ªäº’æ–¥é‡ä¸Šé”</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock1<span class="token punctuation">{</span> lhs<span class="token punctuation">.</span>m<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>adopt_lock <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock2<span class="token punctuation">{</span> rhs<span class="token punctuation">.</span>m<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>adopt_lock <span class="token punctuation">}</span><span class="token punctuation">;</span> 
    <span class="token function">swap</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>object<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºå‰é¢å·²ç»ä½¿ç”¨äº† <code>std::lock</code> ä¸Šé”ï¼Œæ‰€ä»¥åçš„ <code>std::lock_guard</code> æ„é€ éƒ½é¢å¤–ä¼ é€’äº†ä¸€ä¸ª <code>std::adopt_lock</code> å‚æ•°ï¼Œè®©å…¶é€‰æ‹©åˆ°ä¸ä¸Šé”çš„æ„é€ å‡½æ•°ã€‚å‡½æ•°é€€å‡ºä¹Ÿèƒ½æ­£å¸¸è§£é”ã€‚</p><p><code>std::lock</code> ç»™ <code>lhs.m</code> æˆ– <code>rhs.m</code> ä¸Šé”æ—¶è‹¥æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™åœ¨é‡æŠ›å‰å¯¹ä»»ä½•å·²é”çš„å¯¹è±¡è°ƒç”¨ <code>unlock()</code> è§£é”ï¼Œä¹Ÿå°±æ˜¯ <code>std::lock</code> è¦ä¹ˆå°†äº’æ–¥é‡éƒ½ä¸Šé”ï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸é”ã€‚</p>`,3),mn={href:"https://zh.cppreference.com/w/cpp/thread/scoped_lock",target:"_blank",rel:"noopener noreferrer"},_n=n("code",null,"std::scoped_lock",-1),bn={href:"https://zh.cppreference.com/w/cpp/language/raii",target:"_blank",rel:"noopener noreferrer"},hn=n("code",null,"std::lock",-1),gn=o(`<p>æ‰€ä»¥æˆ‘ä»¬å‰é¢çš„ä»£ç å¯ä»¥æ”¹å†™ä¸ºï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> X<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>lhs <span class="token operator">==</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>scoped_lock guard<span class="token punctuation">{</span> lhs<span class="token punctuation">.</span>m<span class="token punctuation">,</span>rhs<span class="token punctuation">.</span>m <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>object<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),fn=n("strong",null,[n("code",null,"std::scoped_lock"),s(" çš„æºç å®ç°ä¸è§£æ")],-1),wn=o('<p>ä½¿ç”¨ <code>std::scoped_lock</code> å¯ä»¥å°†æ‰€æœ‰ <code>std::lock</code> æ›¿æ¢æ‰ï¼Œå‡å°‘é”™è¯¯å‘ç”Ÿã€‚</p><p>ç„¶è€Œå®ƒä»¬çš„å¸®åŠ©éƒ½æ˜¯æœ‰é™çš„ï¼Œä¸€åˆ‡æœ€ç»ˆéƒ½æ˜¯ä¾é å¼€å‘è€…ä½¿ç”¨ä¸ç®¡ç†ã€‚</p><p>æ­»é”æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä»¤äººç›¸å½“å¤´ç–¼çš„é—®é¢˜ï¼Œå¹¶ä¸”æ­»é”ç»å¸¸æ˜¯ä¸å¯é¢„è§ï¼Œç”šè‡³éš¾ä»¥å¤ç°ï¼Œå› ä¸ºåœ¨å¤§éƒ¨åˆ†æ—¶é—´é‡Œï¼Œç¨‹åºéƒ½èƒ½æ­£å¸¸å®Œæˆå·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥<strong>é€šè¿‡ä¸€äº›ç®€å•çš„è§„åˆ™ï¼Œçº¦æŸå¼€å‘è€…çš„è¡Œä¸ºï¼Œå¸®åŠ©å†™å‡ºâ€œæ— æ­»é”â€çš„ä»£ç </strong>ã€‚</p><ul><li><p><strong>é¿å…åµŒå¥—é”</strong></p><p>çº¿ç¨‹è·å–ä¸€ä¸ªé”æ—¶ï¼Œå°±åˆ«å†è·å–ç¬¬äºŒä¸ªé”ã€‚æ¯ä¸ªçº¿ç¨‹åªæŒæœ‰ä¸€ä¸ªé”ï¼Œè‡ªç„¶ä¸ä¼šäº§ç”Ÿæ­»é”ã€‚å¦‚æœå¿…é¡»è¦è·å–å¤šä¸ªé”ï¼Œä½¿ç”¨ <code>std::lock</code> ã€‚</p></li><li><p><strong>é¿å…åœ¨æŒæœ‰é”æ—¶è°ƒç”¨å¤–éƒ¨ä»£ç </strong></p><p>è¿™ä¸ªå»ºè®®æ˜¯å¾ˆç®€å•çš„ï¼šå› ä¸ºä»£ç æ˜¯å¤–éƒ¨æä¾›çš„ï¼Œæ‰€ä»¥æ²¡åŠæ³•ç¡®å®šå¤–éƒ¨è¦åšä»€ä¹ˆã€‚å¤–éƒ¨ç¨‹åºå¯èƒ½åšä»»ä½•äº‹æƒ…ï¼ŒåŒ…æ‹¬è·å–é”ã€‚åœ¨æŒæœ‰é”çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨å¤–éƒ¨ä»£ç è¦è·å–ä¸€ä¸ªé”ï¼Œå°±ä¼šè¿åç¬¬ä¸€ä¸ªæŒ‡å¯¼æ„è§ï¼Œå¹¶é€ æˆæ­»é”ï¼ˆæœ‰æ—¶è¿™æ˜¯æ— æ³•é¿å…çš„ï¼‰ã€‚å½“å†™é€šç”¨ä»£ç æ—¶ï¼ˆæ¯”å¦‚<a href="#%E4%BF%9D%E6%8A%A4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE">ä¿æŠ¤å…±äº«æ•°æ®</a>ä¸­çš„ <code>Date</code> ç±»ï¼‰ã€‚è¿™ä¸æ˜¯æ¥å£è®¾è®¡è€…å¯ä»¥å¤„ç†çš„ï¼Œåªèƒ½å¯„å¸Œæœ›äºè°ƒç”¨æ–¹ä¼ é€’çš„ä»£ç æ˜¯èƒ½æ­£å¸¸æ‰§è¡Œçš„ã€‚</p></li><li><p><strong>ä½¿ç”¨å›ºå®šé¡ºåºè·å–é”</strong></p><p>å¦‚åŒç¬¬ä¸€ä¸ªç¤ºä¾‹é‚£æ ·ï¼Œå›ºå®šçš„é¡ºåºä¸Šé”å°±ä¸å­˜åœ¨é—®é¢˜ã€‚</p></li></ul><h2 id="std-unique-lock-çµæ´»çš„é”" tabindex="-1"><a class="header-anchor" href="#std-unique-lock-çµæ´»çš„é”"><span><code>std::unique_lock</code> çµæ´»çš„é”</span></a></h2>',5),xn={href:"https://zh.cppreference.com/w/cpp/thread/unique_lock",target:"_blank",rel:"noopener noreferrer"},yn=n("code",null,"std::unique_lock",-1),En=n("code",null,"std::lock_guard",-1),qn={href:"https://zh.cppreference.com/w/cpp/thread#.E6.9D.A1.E4.BB.B6.E5.8F.98.E9.87.8F",target:"_blank",rel:"noopener noreferrer"},zn=n("code",null,"std::lock_guard",-1),Bn=n("code",null,"swap",-1),An=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> X<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>lhs <span class="token operator">==</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock1<span class="token punctuation">{</span> lhs<span class="token punctuation">.</span>m<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>defer_lock <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock2<span class="token punctuation">{</span> rhs<span class="token punctuation">.</span>m<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>defer_lock <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">lock</span><span class="token punctuation">(</span>lock1<span class="token punctuation">,</span> lock2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>object<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">++</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Cn=n("code",null,"std::defer_lock",-1),Mn={href:"https://github.com/microsoft/STL/blob/8dc4faadafb52e3e0a627e046b41258032d9bc6a/stl/inc/mutex#L135-L269",target:"_blank",rel:"noopener noreferrer"},Dn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">private</span><span class="token operator">:</span>
    _Mutex<span class="token operator">*</span> _Pmtx <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> _Owns    <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä½ æ‰€è§å¾ˆç®€å•ï¼Œä¸€ä¸ªäº’æ–¥é‡çš„æŒ‡é’ˆï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯è¡¨ç¤ºå¯¹è±¡æ˜¯å¦æ‹¥æœ‰äº’æ–¥é‡æ‰€æœ‰æƒçš„ bool ç±»å‹çš„å¯¹è±¡ <code>_Owns</code> äº†ã€‚æˆ‘ä»¬å‰é¢ä»£ç ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token function">unique_lock</span><span class="token punctuation">(</span>_Mutex<span class="token operator">&amp;</span> _Mtx<span class="token punctuation">,</span> defer_lock_t<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
    <span class="token operator">:</span> <span class="token function">_Pmtx</span><span class="token punctuation">(</span>_STD <span class="token function">addressof</span><span class="token punctuation">(</span>_Mtx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_Owns</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// construct but don&#39;t lock</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,3),Tn=n("strong",null,[s("è¿™ä¸ªæ„é€ å‡½æ•°æ²¡æœ‰ç»™äº’æ–¥é‡ä¸Šé”ï¼Œä¸” "),n("code",null,"_Owns"),s(" ä¸º "),n("code",null,"false"),s(" è¡¨ç¤ºæ²¡æœ‰äº’æ–¥é‡æ‰€æœ‰æƒ")],-1),On=n("code",null,"std::unique_lock",-1),jn={href:"https://zh.cppreference.com/w/cpp/thread/unique_lock/lock",target:"_blank",rel:"noopener noreferrer"},Sn=n("code",null,"lock()",-1),Ln={href:"https://zh.cppreference.com/w/cpp/thread/unique_lock/try_lock",target:"_blank",rel:"noopener noreferrer"},Xn=n("code",null,"try_lock()",-1),Fn={href:"https://zh.cppreference.com/w/cpp/thread/unique_lock/unlock",target:"_blank",rel:"noopener noreferrer"},Pn=n("code",null,"unlock()",-1),Vn=n("code",null,"std::lock",-1),In=n("code",null,"lock()",-1),Gn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// lock the mutex</span>
    <span class="token function">_Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _Pmtx<span class="token operator">-&gt;</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _Owns <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚ä½ æ‰€è§ï¼Œæ­£å¸¸ä¸Šé”ï¼Œå¹¶ä¸”æŠŠ <code>_Owns</code> è®¾ç½®ä¸º <code>true</code>ï¼Œå³è¡¨ç¤ºå½“å‰å¯¹è±¡æ‹¥æœ‰äº’æ–¥é‡çš„æ‰€æœ‰æƒã€‚é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ææ„å‡½æ•°ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token operator">~</span><span class="token function">unique_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_Owns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _Pmtx<span class="token operator">-&gt;</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¿…é¡»å¾—æ˜¯<strong>å½“å‰å¯¹è±¡æ‹¥æœ‰äº’æ–¥é‡çš„æ‰€æœ‰æƒææ„å‡½æ•°æ‰ä¼šè°ƒç”¨ unlock() è§£é”äº’æ–¥é‡</strong>ã€‚æˆ‘ä»¬çš„ä»£ç å› ä¸ºè°ƒç”¨äº† <code>lock</code> ï¼Œæ‰€ä»¥ <code>_Owns</code> è®¾ç½®ä¸º <code>true</code> ï¼Œå‡½æ•°ç»“æŸçš„æ—¶å€™ä¼šè§£é”äº’æ–¥é‡ã€‚</p><hr><p>è®¾è®¡æŒºå¥‡æ€ªçš„å¯¹å§ï¼Œè¿™ä¸ªæ‰€æœ‰æƒè¯­ä¹‰ã€‚å…¶å®ä¸Šé¢çš„ä»£ç è¿˜ä¸å¤Ÿç®€å•ç›´æ¥ï¼Œæˆ‘ä»¬å†ä¸¾ä¸ªä¾‹å­ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span>lock<span class="token punctuation">{</span> m<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>adopt_lock <span class="token punctuation">}</span><span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),Rn={href:"https://godbolt.org/z/KqKrETe6d",target:"_blank",rel:"noopener noreferrer"},Kn=n("code",null,"std::adopt_lock",-1),Nn=n("strong",null,"æœ‰æ‰€æœ‰æƒ",-1),Wn=n("code",null,"_Owns",-1),Yn=n("code",null,"true",-1),Jn=n("code",null,"lock()",-1),Qn=n("code",null,"_Validate()",-1),Zn=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">_Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token comment">// check if the mutex can be locked</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_Pmtx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_Throw_system_error</span><span class="token punctuation">(</span>errc<span class="token double-colon punctuation">::</span>operation_not_permitted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>_Owns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_Throw_system_error</span><span class="token punctuation">(</span>errc<span class="token double-colon punctuation">::</span>resource_deadlock_would_occur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Hn=n("code",null,"_Owns",-1),Un=n("code",null,"true",-1),$n={href:"https://github.com/gcc-mirror/gcc/blob/3e3d115c946944c81d8231dfbe778d4dae26cbb7/libstdc%2B%2B-v3/include/bits/unique_lock.h#L141-L144",target:"_blank",rel:"noopener noreferrer"},ns=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>lock<span class="token punctuation">.</span><span class="token function">mutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ <code>std::unique_lock</code> è¦æƒ³è°ƒç”¨ <code>lock()</code> æˆå‘˜å‡½æ•°ï¼Œå¿…é¡»æ˜¯å½“å‰<strong>æ²¡æœ‰æ‰€æœ‰æƒ</strong>ã€‚</p><p>æ‰€ä»¥æ­£å¸¸çš„ç”¨æ³•å…¶å®æ˜¯ï¼Œå…ˆä¸Šé”äº†äº’æ–¥é‡ï¼Œç„¶åä¼ é€’ <code>std::adopt_lock</code> æ„é€  <code>std::unique_lock</code> å¯¹è±¡è¡¨ç¤ºæ‹¥æœ‰äº’æ–¥é‡çš„æ‰€æœ‰æƒï¼Œå³å¯åœ¨ææ„çš„æ—¶å€™æ­£å¸¸è§£é”ã€‚å¦‚ä¸‹ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    m<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span>lock <span class="token punctuation">{</span> m<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>adopt_lock <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>ç®€è€Œè¨€ä¹‹ï¼š</p><ul><li>ä½¿ç”¨ <code>std::defer_lock</code> æ„é€ å‡½æ•°ä¸ä¸Šé”ï¼Œè¦æ±‚æ„é€ ä¹‹åä¸Šé”</li><li>ä½¿ç”¨ <code>std::adopt_lock</code> æ„é€ å‡½æ•°ä¸ä¸Šé”ï¼Œè¦æ±‚åœ¨æ„é€ ä¹‹å‰äº’æ–¥é‡ä¸Šé”</li><li>é»˜è®¤æ„é€ ä¼šä¸Šé”ï¼Œè¦æ±‚æ„é€ å‡½æ•°ä¹‹å‰å’Œæ„é€ å‡½æ•°ä¹‹åéƒ½ä¸èƒ½å†æ¬¡ä¸Šé”</li></ul><hr><p>æˆ‘ä»¬å‰é¢æåˆ°äº† <code>std::unique_lock</code> æ›´åŠ çµæ´»ï¼Œé‚£ä¹ˆçµæ´»åœ¨å“ªï¼Ÿå¾ˆç®€å•ï¼Œå®ƒæ‹¥æœ‰ <code>lock()</code> å’Œ <code>unlock()</code> æˆå‘˜å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//code..</span>
    
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lock<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// æ¶‰åŠå…±äº«èµ„æºçš„ä¿®æ”¹çš„ä»£ç ...</span>

    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£é”å¹¶é‡Šæ”¾æ‰€æœ‰æƒï¼Œææ„å‡½æ•°ä¸ä¼šå† unlock()</span>

    <span class="token comment">//code..</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œä¸æ˜¯åƒä¹‹å‰ <code>std::lock_guard</code> ä¸€æ ·ä½¿ç”¨ <code>{}</code>ã€‚</p><p>å¦å¤–å†èŠä¸€èŠå¼€é”€å§ï¼Œå…¶å®å€’ä¹Ÿè¿˜å¥½ï¼Œå¤šäº†ä¸€ä¸ª <code>bool</code> ï¼Œå†…å­˜å¯¹é½ï¼Œx64 ç¯å¢ƒä¹Ÿå°±æ˜¯ <code>16</code> å­—èŠ‚ã€‚è¿™éƒ½ä¸æ˜¯æœ€é‡è¦çš„ï¼Œä¸»è¦æ˜¯å¤æ‚æ€§å’Œéœ€æ±‚ï¼Œé€šå¸¸å»ºè®®ä¼˜å…ˆ <code>std::lock_guard</code>ï¼Œå½“å®ƒæ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚æˆ–è€…æ˜¾å¾—ä»£ç éå¸¸ç¹çï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>std::unique_lock</code>ã€‚</p><h2 id="åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡" tabindex="-1"><a class="header-anchor" href="#åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡"><span>åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡</span></a></h2>`,13),ss={href:"https://zh.cppreference.com/w/cpp/named_req/Mutex",target:"_blank",rel:"noopener noreferrer"},as=n("em",null,"äº’æ–¥ä½“ (Mutex)",-1),ts=n("strong",null,"ä¸å¯å¤åˆ¶ä¸å¯ç§»åŠ¨",-1),os=n("code",null,"std::unique_lock",-1),es=n("code",null,"std::unique_lock",-1),ps=n("code",null,"std::unique_lock",-1),cs=n("em",null,"å°±æ˜¯è°ƒç”¨ç§»åŠ¨æ„é€ ",-1),ls={href:"https://zh.cppreference.com/w/cpp/language/return#.E8.87.AA.E5.8A.A8.E4.BB.8E.E5.B1.80.E9.83.A8.E5.8F.98.E9.87.8F.E5.92.8C.E5.BD.A2.E5.8F.82.E7.A7.BB.E5.8A.A8",target:"_blank",rel:"noopener noreferrer"},us=n("code",null,"std::unique_lock",-1),is={href:"https://zh.cppreference.com/w/cpp/utility/move",target:"_blank",rel:"noopener noreferrer"},ds=n("code",null,"std::move",-1),rs=o(`<blockquote><p>è¯·å‹¿å¯¹ç§»åŠ¨è¯­ä¹‰å’Œè½¬ç§»æ‰€æœ‰æƒæŠ±æœ‰é”™è¯¯çš„å¹»æƒ³ï¼Œæˆ‘ä»¬è¯´çš„æ— éæ˜¯è°ƒç”¨ <code>std::unique_lock</code> çš„ç§»åŠ¨æ„é€ ç½¢äº†ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>_NODISCARD_CTOR_LOCK <span class="token function">unique_lock</span><span class="token punctuation">(</span>unique_lock<span class="token operator">&amp;&amp;</span> _Other<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token operator">:</span> <span class="token function">_Pmtx</span><span class="token punctuation">(</span>_Other<span class="token punctuation">.</span>_Pmtx<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_Owns</span><span class="token punctuation">(</span>_Other<span class="token punctuation">.</span>_Owns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _Other<span class="token punctuation">.</span>_Pmtx <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    _Other<span class="token punctuation">.</span>_Owns <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†æ•°æ®æˆå‘˜èµ‹ç»™æ–°å¯¹è±¡ï¼ŒåŸæ¥çš„ç½®ç©ºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ <em>â€œ<strong>æ‰€æœ‰æƒ</strong>â€è½¬ç§»</em>ï¼Œåˆ‡å‹¿è¢«è¯è¯­è¿·æƒ‘ã€‚</p></blockquote><p><code>std::unique_lock</code> æ˜¯åªèƒ½ç§»åŠ¨ä¸å¯å¤åˆ¶çš„ç±»ï¼Œå®ƒç§»åŠ¨å³æ ‡å¿—å…¶ç®¡ç†çš„äº’æ–¥é‡çš„æ‰€æœ‰æƒè½¬ç§»äº†ã€‚</p><p>ä¸€ç§å¯èƒ½çš„ä½¿ç”¨æ˜¯å…è®¸å‡½æ•°å»é”ä½ä¸€ä¸ªäº’æ–¥é‡ï¼Œå¹¶å°†äº’æ–¥é‡çš„æ‰€æœ‰æƒè½¬ç§»åˆ°è°ƒç”¨è€…ä¸Šï¼Œæ‰€ä»¥è°ƒç”¨è€…å¯ä»¥åœ¨è¿™ä¸ªé”ä¿æŠ¤çš„èŒƒå›´å†…æ‰§è¡Œä»£ç ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span><span class="token function">get_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">extern</span> std<span class="token double-colon punctuation">::</span>mutex some_mutex<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lk<span class="token punctuation">{</span> some_mutex <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> lk<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">process_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>unique_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lk<span class="token punctuation">{</span> <span class="token function">get_lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‰§è¡Œä¸€äº›ä»»åŠ¡...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>return lk</code> è¿™é‡Œä¼šè°ƒç”¨ç§»åŠ¨æ„é€ ï¼Œå°†äº’æ–¥é‡çš„æ‰€æœ‰æƒè½¬ç§»ç»™è°ƒç”¨æ–¹ï¼Œ <code>process_data</code> å‡½æ•°ç»“æŸçš„æ—¶å€™ä¼šè§£é”äº’æ–¥é‡ã€‚</p>`,5),ks=n("code",null,"extern std::mutex some_mutex",-1),vs=n("em",null,"æ‰€è°“çš„åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡ï¼Œå…¶å®åªæ˜¯ä¼ é€’äº†å®ƒä»¬çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ç½¢äº†",-1),ms={href:"https://zh.cppreference.com/w/cpp/language/lifetime",target:"_blank",rel:"noopener noreferrer"},_s={href:"https://zh.cppreference.com/w/cpp/language/storage_duration",target:"_blank",rel:"noopener noreferrer"},bs=n("p",null,[s("å¦‚æœä½ ç®€å•å†™ä¸€ä¸ª "),n("code",null,"std::mutex some_mutex"),s(" é‚£ä¹ˆå‡½æ•° "),n("code",null,"process_data"),s(" ä¸­çš„ "),n("code",null,"lk"),s(" ä¼šæŒæœ‰ä¸€ä¸ªæ‚¬å‚æŒ‡é’ˆã€‚")],-1),hs=n("code",null,"extern std::mutex",-1),gs={href:"https://godbolt.org/z/z47x1Es5z",target:"_blank",rel:"noopener noreferrer"},fs=n("code",null,"new std::mutex",-1),ws=o('<p><code>std::unique_lock</code> æ˜¯çµæ´»çš„ï¼ŒåŒæ ·å…è®¸åœ¨å¯¹è±¡é”€æ¯ä¹‹å‰å°±è§£é”äº’æ–¥é‡ï¼Œè°ƒç”¨ <code>unlock()</code> æˆå‘˜å‡½æ•°å³å¯ï¼Œä¸å†å¼ºè°ƒã€‚</p><h2 id="ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹"><span>ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹</span></a></h2><p>ä¿æŠ¤å…±äº«æ•°æ®å¹¶éå¿…é¡»ä½¿ç”¨äº’æ–¥é‡ï¼Œäº’æ–¥é‡åªæ˜¯å…¶ä¸­ä¸€ç§å¸¸è§çš„æ–¹å¼è€Œå·²ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œä¹Ÿæœ‰ä¸“é—¨çš„ä¿æŠ¤æ–¹å¼ï¼Œæ¯”å¦‚<strong>å¯¹äºå…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹çš„ä¿æŠ¤</strong>ã€‚æˆ‘ä»¬é€šå¸¸å°±ä¸ä¼šç”¨äº’æ–¥é‡ï¼Œ<strong>è¿™ä¼šé€ æˆå¾ˆå¤šçš„é¢å¤–å¼€é”€</strong>ã€‚</p><p>æˆ‘ä»¬ä¸æƒ³ä¸ºå„ä½ä»‹ç»å…¶å®ƒä¹±ä¸ƒå…«ç³Ÿçš„å„ç§ä¿æŠ¤åˆå§‹åŒ–çš„æ–¹å¼ï¼Œæˆ‘ä»¬åªä»‹ç»ä¸‰ç§ï¼š<strong>åŒæ£€é”ï¼ˆé”™è¯¯ï¼‰</strong>ã€<strong>ä½¿ç”¨ <code>std::call_once</code></strong>ã€<strong>é™æ€å±€éƒ¨å˜é‡åˆå§‹åŒ–åœ¨ C++11 æ˜¯çº¿ç¨‹å®‰å…¨</strong>ã€‚</p>',4),xs=o(`<li><p><strong>åŒæ£€é”ï¼ˆé”™è¯¯ï¼‰çº¿ç¨‹ä¸å®‰å…¨</strong></p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">// 1</span>
        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>mutex<span class="token operator">&gt;</span> lk<span class="token punctuation">{</span> m <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 2</span>
            ptr<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token keyword">new</span> some<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    ptr<span class="token operator">-&gt;</span><span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 4</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â‘  æ˜¯æŸ¥çœ‹æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºï¼Œç©ºæ‰éœ€è¦åˆå§‹åŒ–ï¼Œæ‰éœ€è¦è·å–é”ã€‚æŒ‡é’ˆä¸ºç©ºï¼Œå½“è·å–é”åä¼šå†æ£€æŸ¥ä¸€æ¬¡æŒ‡é’ˆâ‘¡ï¼ˆè¿™å°±æ˜¯åŒé‡æ£€æŸ¥ï¼‰ï¼Œé¿å…å¦ä¸€çº¿ç¨‹åœ¨ç¬¬ä¸€æ¬¡æ£€æŸ¥åå†åšåˆå§‹åŒ–ï¼Œå¹¶ä¸”è®©å½“å‰çº¿ç¨‹è·å–é”ã€‚</p><p>ç„¶è€Œè¿™æ˜¾ç„¶æ²¡ç”¨ï¼Œå› ä¸º<strong>æœ‰æ½œåœ¨çš„æ¡ä»¶ç«äº‰</strong>ã€‚æœªè¢«é”ä¿æŠ¤çš„è¯»å–æ“ä½œâ‘ æ²¡æœ‰ä¸å…¶ä»–çº¿ç¨‹é‡Œè¢«é”ä¿æŠ¤çš„å†™å…¥æ“ä½œâ‘¢è¿›è¡ŒåŒæ­¥ï¼Œå› æ­¤å°±ä¼šäº§ç”Ÿæ¡ä»¶ç«äº‰ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼šä¸€ä¸ªçº¿ç¨‹çŸ¥é“å¦ä¸€ä¸ªçº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œâ‘¢ï¼Œä½†æ˜¯æ­¤æ—¶è¿˜æ²¡æœ‰åˆ›å»º some å¯¹è±¡ï¼Œè€Œåªæ˜¯åˆ†é…å†…å­˜å¯¹æŒ‡é’ˆå†™å…¥ã€‚é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹åœ¨â‘ çš„æ—¶å€™å°±ä¸ä¼šè¿›å…¥ï¼Œç›´æ¥æ‰§è¡Œäº† <code>ptr-&gt;do_something()</code>â‘£ï¼Œå¾—ä¸åˆ°æ­£ç¡®çš„ç»“æœï¼Œå› ä¸ºå¯¹è±¡è¿˜æ²¡æ„é€ ã€‚</p><blockquote><p>å¦‚æœä½ è§‰å¾—éš¾ä»¥ç†è§£ï¼Œé‚£å°±è®°ä½ <code>ptr.reset(new some);</code> å¹¶éæ˜¯ä¸å¯æ‰“æ–­ä¸å¯äº¤æ¢çš„å›ºå®šæŒ‡ä»¤ã€‚</p><p>è¿™ç§é”™è¯¯å†™æ³•åœ¨ä¸€äº›å•ä¾‹ä¸­ä¹Ÿéå¸¸çš„å¸¸è§ã€‚å¦‚æœä½ çš„åŒäº‹æˆ–ä¸Šå¸å†™å‡ºæ­¤ä»£ç ï¼Œä¸€èˆ¬ä¸å»ºè®®æŒ‡å‡ºï¼Œå› ä¸ºä¸è§å¾—ä½ èƒ½æ•™ä¼šä»–ä»¬ï¼Œä¸è¦â€œæ²¡äº‹æ‰¾äº‹â€ï¼Œåªè¦ä¸å½±å“è‡ªå·±å³å¯ã€‚</p></blockquote></li>`,1),ys={href:"https://zh.cppreference.com/w/cpp/thread/call_once",target:"_blank",rel:"noopener noreferrer"},Es=n("code",null,"std::call_once",-1),qs={href:"https://zh.cppreference.com/w/cpp/thread/once_flag",target:"_blank",rel:"noopener noreferrer"},zs=n("code",null,"std::once_flag",-1),Bs=n("code",null,"std::call_once",-1),As=n("strong",null,[s("ä½¿ç”¨ "),n("code",null,"std::call_once"),s(" æ¯”æ˜¾å¼ä½¿ç”¨äº’æ–¥é‡æ¶ˆè€—çš„èµ„æºæ›´å°‘ï¼Œç‰¹åˆ«æ˜¯å½“åˆå§‹åŒ–å®Œæˆä¹‹å")],-1),Cs=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>some<span class="token operator">&gt;</span>ptr<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>mutex m<span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>once_flag resource_flag<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">init_resource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ptr<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token keyword">new</span> some<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">call_once</span><span class="token punctuation">(</span>resource_flag<span class="token punctuation">,</span> init_resource<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çº¿ç¨‹å®‰å…¨çš„ä¸€æ¬¡åˆå§‹åŒ–</span>
    ptr<span class="token operator">-&gt;</span><span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Ms=n("code",null,"std::once_flag",-1),Ds=n("code",null,"std::call_once",-1),Ts=n("strong",null,"ä¸€æ¬¡",-1),Os=n("code",null,"std::call_once",-1),js={href:"https://zh.cppreference.com/w/cpp/named_req/Callable",target:"_blank",rel:"noopener noreferrer"},Ss=n("em",null,"å¯è°ƒç”¨ (Callable)",-1),Ls=o(`<p>â€œ<strong>åˆå§‹åŒ–</strong>â€ï¼Œè‡ªç„¶æ˜¯<strong>ä¸€æ¬¡</strong>ã€‚ä½†æ˜¯ <code>std::call_once</code> ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–æƒ…å†µï¼ˆæ¯”å¦‚å¼‚å¸¸ï¼‰ä¼šè®©ä¼ å…¥çš„å¯è°ƒç”¨å¯¹è±¡è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå³â€œ<strong>å¤šæ¬¡</strong>â€åˆå§‹åŒ–ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>once_flag flag<span class="token punctuation">;</span>
<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">call_once</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>n<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;ç¬¬&quot;</span> <span class="token operator">&lt;&lt;</span> n <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;æ¬¡è°ƒç”¨\\n&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">runtime_error</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚å¸¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>exception<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>exception<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),Xs={href:"https://godbolt.org/z/aWqfEchd6",target:"_blank",rel:"noopener noreferrer"},Fs=o(`<li><p><strong>é™æ€å±€éƒ¨å˜é‡åˆå§‹åŒ–åœ¨ C++11 æ˜¯çº¿ç¨‹å®‰å…¨</strong></p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">my_class</span><span class="token punctuation">;</span>
my_class<span class="token operator">&amp;</span> <span class="token function">get_my_class_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> my_class instance<span class="token punctuation">;</span>  <span class="token comment">// çº¿ç¨‹å®‰å…¨çš„åˆå§‹åŒ–è¿‡ç¨‹ åˆå§‹åŒ–ä¸¥æ ¼å‘ç”Ÿä¸€æ¬¡</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤šçº¿ç¨‹å¯ä»¥å®‰å…¨çš„è°ƒç”¨ <code>get_my_class_instance</code> å‡½æ•°ï¼Œä¸ç”¨ä¸ºæ•°æ®ç«äº‰è€Œæ‹…å¿ƒã€‚æ­¤æ–¹å¼ä¹Ÿåœ¨å•ä¾‹ä¸­å¤šè§ï¼Œæ˜¯ç®€å•åˆç†çš„åšæ³•ã€‚</p></li>`,1),Ps=n("hr",null,null,-1),Vs=n("p",null,[s("å…¶å®è¿˜æœ‰ä¸å°‘å…¶ä»–çš„åšæ³•æˆ–è€…åä¾‹ï¼Œä½†æ˜¯è§‰å¾—æ²¡å¿…è¦å†èŠäº†ï¼Œå› ä¸ºæœ¬æ–‡ä¸æ˜¯è¯¦å°½çš„æ–‡æ¡£ï¼Œè€Œæ˜¯â€œ"),n("strong",null,"æ•™ç¨‹"),s("â€ã€‚")],-1),Is=n("h2",{id:"ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„"},[n("span",null,"ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„")])],-1),Gs=n("p",null,"è¯•æƒ³ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„å­˜å‚¨äº†ç”¨æˆ·çš„è®¾ç½®ä¿¡æ¯ï¼Œæ¯æ¬¡ç”¨æˆ·æ‰“å¼€ç¨‹åºçš„æ—¶å€™ï¼Œéƒ½è¦è¿›è¡Œè¯»å–ï¼Œä¸”è¿è¡Œæ—¶å¾ˆå¤šåœ°æ–¹éƒ½ä¾èµ–è¿™ä¸ªæ•°æ®ç»“æ„éœ€è¦è¯»å–ï¼Œæ‰€ä»¥ä¸ºäº†æ•ˆç‡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¤šçº¿ç¨‹è¯»å†™ã€‚è¿™ä¸ªæ•°æ®ç»“æ„å¾ˆå°‘è¿›è¡Œæ”¹å˜ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œå¤šçº¿ç¨‹è¯»å–ï¼Œæ˜¯æ²¡æœ‰æ•°æ®ç«äº‰çš„ï¼Œæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™åˆä¸å¯é¿å…çš„æœ‰ä¿®æ”¹å’Œè¯»å–éƒ½è¦å·¥ä½œçš„æ—¶å€™ï¼Œæ‰€ä»¥ä¾ç„¶å¿…é¡»å¾—ä½¿ç”¨äº’æ–¥é‡è¿›è¡Œä¿æŠ¤ã€‚",-1),Rs=n("code",null,"std::mutex",-1),Ks={href:"https://zh.wikipedia.org/wiki/%E8%AF%BB%E5%86%99%E9%94%81",target:"_blank",rel:"noopener noreferrer"},Ns=n("em",null,[n("strong",null,"è¯»å†™é”")],-1),Ws={href:"https://zh.cppreference.com/w/cpp/thread/shared_timed_mutex",target:"_blank",rel:"noopener noreferrer"},Ys=n("code",null,"std::shared_timed_mutex",-1),Js={href:"https://zh.cppreference.com/w/cpp/thread/shared_mutex",target:"_blank",rel:"noopener noreferrer"},Qs=n("code",null,"std::shared_mutex",-1),Zs=n("code",null,"std::shared_mutex",-1),Hs=n("code",null,"std::lock_guard",-1),Us=n("code",null,"std::unique_lock",-1),$s=n("code",null,"std::mutex",-1),na=n("em",null,"å†™çº¿ç¨‹",-1),sa=n("em",null,"è¯»çº¿ç¨‹",-1),aa={href:"https://zh.cppreference.com/w/cpp/thread/shared_lock",target:"_blank",rel:"noopener noreferrer"},ta=n("code",null,"std::shared_lock<std::shared_mutex>",-1),oa=o(`<div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Settings</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> data_<span class="token punctuation">;</span>
    <span class="token keyword">mutable</span> std<span class="token double-colon punctuation">::</span>shared_mutex mutex_<span class="token punctuation">;</span> <span class="token comment">// â€œM&amp;M è§„åˆ™â€ï¼šmutable ä¸ mutex ä¸€èµ·å‡ºç°</span>

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> key<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_mutex<span class="token operator">&gt;</span> lock<span class="token punctuation">{</span> mutex_ <span class="token punctuation">}</span><span class="token punctuation">;</span>
        data_<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token double-colon punctuation">::</span>string <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> key<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>shared_lock<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_mutex<span class="token operator">&gt;</span> <span class="token function">lock</span><span class="token punctuation">(</span>mutex_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">auto</span> it <span class="token operator">=</span> data_<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> data_<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> it<span class="token operator">-&gt;</span>second <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°é”®è¿”å›ç©ºå­—ç¬¦ä¸²</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),ea={href:"https://github.com/Mq-b/ModernCpp-ConcurrentProgramming-Tutorial/blob/main/code/03%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE/%E4%BF%9D%E6%8A%A4%E4%B8%8D%E5%B8%B8%E6%9B%B4%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.cpp",target:"_blank",rel:"noopener noreferrer"},pa={href:"https://godbolt.org/z/ezh1Pdo5E",target:"_blank",rel:"noopener noreferrer"},ca=n("p",null,[n("code",null,"std::shared_timed_mutex"),s(" å…·æœ‰ "),n("code",null,"std::shared_mutex"),s(" çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”é¢å¤–æ”¯æŒè¶…æ—¶åŠŸèƒ½ã€‚æ‰€ä»¥ä»¥ä¸Šä»£ç å¯ä»¥éšæ„æ›´æ¢è¿™ä¸¤ä¸ªäº’æ–¥é‡ã€‚")],-1),la=n("h2",{id:"std-recursive-mutex",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#std-recursive-mutex"},[n("span",null,[n("code",null,"std::recursive_mutex")])])],-1),ua=n("code",null,"std::mutex",-1),ia={href:"https://zh.cppreference.com/w/cpp/language/ub",target:"_blank",rel:"noopener noreferrer"},da=n("em",null,"æœªå®šä¹‰è¡Œä¸º",-1),ra=n("code",null,"std::recursive_mutex",-1),ka=o(`<p><code>std::recursive_mutex</code> æ˜¯ C++ æ ‡å‡†åº“æä¾›çš„ä¸€ç§äº’æ–¥é‡ç±»å‹ï¼Œå®ƒå…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡é”å®šåŒä¸€ä¸ªäº’æ–¥é‡ï¼Œè€Œä¸ä¼šé€ æˆæ­»é”ã€‚å½“åŒä¸€çº¿ç¨‹å¤šæ¬¡å¯¹åŒä¸€ä¸ª <code>std::recursive_mutex</code> è¿›è¡Œé”å®šæ—¶ï¼Œ<strong>åªæœ‰åœ¨è§£é”ä¸é”å®šæ¬¡æ•°ç›¸åŒ¹é…æ—¶ï¼Œäº’æ–¥é‡æ‰ä¼šçœŸæ­£é‡Šæ”¾</strong>ã€‚ä½†å®ƒå¹¶ä¸å½±å“ä¸åŒçº¿ç¨‹å¯¹åŒä¸€ä¸ªäº’æ–¥é‡è¿›è¡Œé”å®šçš„æƒ…å†µã€‚ä¸åŒçº¿ç¨‹å¯¹åŒä¸€ä¸ªäº’æ–¥é‡è¿›è¡Œé”å®šæ—¶ï¼Œä¼šæŒ‰ç…§äº’æ–¥é‡çš„è§„åˆ™<strong>è¿›è¡Œé˜»å¡</strong>ï¼Œ</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mutex&gt;</span></span>

std<span class="token double-colon punctuation">::</span>recursive_mutex mtx<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">recursive_function</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é€’å½’å‡½æ•°ï¼Œæ¯æ¬¡é€’å½’éƒ½ä¼šé”å®šäº’æ–¥é‡</span>
    mtx<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Locked by thread: &quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, count: &quot;</span> <span class="token operator">&lt;&lt;</span> count <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">recursive_function</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€’å½’è°ƒç”¨</span>
    <span class="token punctuation">}</span>
    mtx<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è§£é”äº’æ–¥é‡</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t1</span><span class="token punctuation">(</span>recursive_function<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">t2</span><span class="token punctuation">(</span>recursive_function<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),va={href:"https://godbolt.org/z/aefrYbGd7",target:"_blank",rel:"noopener noreferrer"},ma={href:"https://zh.cppreference.com/w/cpp/thread/recursive_mutex/lock",target:"_blank",rel:"noopener noreferrer"},_a=n("strong",null,[n("code",null,"lock")],-1),ba=n("code",null,"lock",-1),ha=n("code",null,"unlock",-1),ga=n("strong",null,"é‡Šæ”¾",-1),fa={href:"https://zh.cppreference.com/w/cpp/thread/recursive_mutex/unlock",target:"_blank",rel:"noopener noreferrer"},wa=n("strong",null,[n("code",null,"unlock")],-1),xa={href:"https://zh.cppreference.com/w/cpp/thread/recursive_mutex/lock",target:"_blank",rel:"noopener noreferrer"},ya=n("code",null,"unlock()",-1),Ea=n("strong",null,"è§£é”äº’æ–¥ä½“",-1),qa=o(`<p>æˆ‘ä»¬é‡ç‚¹çš„å¼ºè°ƒäº†ä¸€ä¸‹è¿™ä¸¤ä¸ªæˆå‘˜å‡½æ•°çš„è¿™ä¸ªæ¦‚å¿µï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œæ€»è€Œè¨€ä¹‹å°±æ˜¯ <code>unlock</code> å¿…é¡»å’Œ <code>lock</code> çš„è°ƒç”¨æ¬¡æ•°ä¸€æ ·ï¼Œæ‰ä¼šçœŸæ­£è§£é”äº’æ–¥é‡ã€‚</p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>std::lock_guard</code>ã€<code>std::unique_lock</code> å¸®æˆ‘ä»¬ç®¡ç† <code>std::recursive_mutex</code>ï¼Œè€Œéæ˜¾å¼è°ƒç”¨ <code>lock</code> ä¸ <code>unlock</code>ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">recursive_function</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>lock_guard<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>recursive_mutex<span class="token operator">&gt;</span> lc<span class="token punctuation">{</span> mtx <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Locked by thread: &quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>this_thread<span class="token double-colon punctuation">::</span><span class="token function">get_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, count: &quot;</span> <span class="token operator">&lt;&lt;</span> count <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">recursive_function</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),za={href:"https://godbolt.org/z/d63zrG1cK",target:"_blank",rel:"noopener noreferrer"},Ba=n("h2",{id:"newã€delete-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#newã€delete-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—"},[n("span",null,[n("code",null,"new"),s("ã€"),n("code",null,"delete"),s(" æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ")])])],-1),Aa=n("p",null,[s("å¦‚æœä½ çš„æ ‡å‡†è¾¾åˆ° "),n("strong",null,"C++11"),s("ï¼Œè¦æ±‚ä¸‹åˆ—"),n("strong",null,"å‡½æ•°"),s("æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š")],-1),Ca={href:"https://zh.cppreference.com/w/cpp/memory/new/operator_new",target:"_blank",rel:"noopener noreferrer"},Ma=n("code",null,"new",-1),Da={href:"https://zh.cppreference.com/w/cpp/memory/new/operator_delete",target:"_blank",rel:"noopener noreferrer"},Ta=n("code",null,"delete",-1),Oa=n("strong",null,"åº“",-1),ja=n("li",null,[s("å…¨å±€ "),n("code",null,"new"),s(" è¿ç®—ç¬¦å’Œ "),n("code",null,"delete"),s(" è¿ç®—ç¬¦çš„ç”¨æˆ·æ›¿æ¢ç‰ˆæœ¬")],-1),Sa={href:"https://zh.cppreference.com/w/cpp/memory/c/calloc",target:"_blank",rel:"noopener noreferrer"},La={href:"https://zh.cppreference.com/w/cpp/memory/c/malloc",target:"_blank",rel:"noopener noreferrer"},Xa={href:"https://zh.cppreference.com/w/cpp/memory/c/realloc",target:"_blank",rel:"noopener noreferrer"},Fa={href:"https://zh.cppreference.com/w/cpp/memory/c/aligned_alloc",target:"_blank",rel:"noopener noreferrer"},Pa={href:"https://zh.cppreference.com/w/cpp/memory/c/free",target:"_blank",rel:"noopener noreferrer"},Va=o(`<p>æ‰€ä»¥ä»¥ä¸‹å‡½æ•°åœ¨å¤šçº¿ç¨‹è¿è¡Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    T<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> T<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†…å­˜åˆ†é…ã€é‡Šæ”¾æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨ï¼Œæ„é€ å’Œææ„ä¸æ¶‰åŠå…±äº«èµ„æºã€‚è€Œå±€éƒ¨å¯¹è±¡ <code>p</code> å¯¹äºæ¯ä¸ªçº¿ç¨‹æ¥è¯´æ˜¯ç‹¬ç«‹çš„ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å…¶è‡ªå·±çš„ <code>p</code> å¯¹è±¡å®ä¾‹ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šå…±äº«åŒä¸€ä¸ªå¯¹è±¡ï¼Œè‡ªç„¶æ²¡æœ‰æ•°æ®ç«äº‰ã€‚</p><p>å¦‚æœ <code>p</code> æ˜¯å…¨å±€å¯¹è±¡ï¼ˆæˆ–è€…å¤–éƒ¨çš„ï¼Œåªè¦å¯è¢«å¤šä¸ªçº¿ç¨‹è¯»å†™ï¼‰ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å…¶è¿›è¡Œè®¿é—®å’Œä¿®æ”¹æ—¶ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ç«äº‰å’Œæœªå®šä¹‰è¡Œä¸ºã€‚å› æ­¤ï¼Œç¡®ä¿å…¨å±€å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨è®¿é—®é€šå¸¸éœ€è¦é¢å¤–çš„åŒæ­¥æªæ–½ï¼Œæ¯”å¦‚äº’æ–¥é‡æˆ–åŸå­æ“ä½œã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>T<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    p <span class="token operator">=</span> <span class="token keyword">new</span> T<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// å­˜åœ¨æ•°æ®ç«äº‰</span>
    <span class="token keyword">delete</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å³ä½¿ <code>p</code> æ˜¯å±€éƒ¨å¯¹è±¡ï¼Œå¦‚æœæ„é€ å‡½æ•°ï¼ˆææ„åŒç†ï¼‰æ¶‰åŠè¯»å†™å…±äº«èµ„æºï¼Œé‚£ä¹ˆä¸€æ ·å­˜åœ¨æ•°æ®ç«äº‰ï¼Œéœ€è¦è¿›è¡Œé¢å¤–çš„åŒæ­¥æªæ–½è¿›è¡Œä¿æŠ¤ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">X</span><span class="token punctuation">{</span>
    <span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">int</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token double-colon punctuation">::</span>n <span class="token operator">+=</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    X<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> X<span class="token punctuation">{</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// å­˜åœ¨æ•°æ®ç«äº‰</span>
    <span class="token keyword">delete</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),Ia=n("code",null,"std::cout",-1),Ga={href:"https://godbolt.org/z/acT7bcz8E",target:"_blank",rel:"noopener noreferrer"},Ra=o(`<hr><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯è‡ªå·±é‡è½½ <code>operator new</code>ã€<code>operator delete</code> æ›¿æ¢äº†åº“çš„<strong>å…¨å±€</strong>ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒçš„çº¿ç¨‹å®‰å…¨å°±è¦æˆ‘ä»¬æ¥ä¿è¯ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token comment">// å…¨å±€çš„ new è¿ç®—ç¬¦ï¼Œæ›¿æ¢äº†åº“çš„ç‰ˆæœ¬</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span>  <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>size_t count<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token double-colon punctuation">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä»£ç æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸º C++11 ä¿è¯äº† new è¿ç®—ç¬¦çš„åº“ç‰ˆæœ¬ï¼Œå³ <code>::operator new</code> æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨å®ƒè‡ªç„¶ä¸æˆé—®é¢˜ã€‚å¦‚æœä½ éœ€è¦æ›´å¤šçš„æ“ä½œï¼Œå°±å¾—ä½¿ç”¨äº’æ–¥é‡ä¹‹ç±»çš„æ–¹å¼ä¿æŠ¤äº†ã€‚</p><hr><p>æ€»è€Œè¨€ä¹‹ï¼Œ<code>new</code> è¡¨è¾¾å¼çº¿ç¨‹å®‰å…¨è¦è€ƒè™‘ä¸‰æ–¹é¢ï¼š<code>operator new</code>ã€æ„é€ å‡½æ•°ã€ä¿®æ”¹æŒ‡é’ˆã€‚</p><p><code>delete</code> è¡¨è¾¾å¼çº¿ç¨‹å®‰å…¨è€ƒè™‘ä¸¤æ–¹é¢ï¼š<code>operator delete</code>ã€ææ„å‡½æ•°ã€‚</p><p>C++ åªä¿è¯äº† <code>operator new</code>ã€<code>operator delete</code> è¿™ä¸¤ä¸ªæ–¹é¢çš„çº¿ç¨‹å®‰å…¨ï¼ˆä¸åŒ…æ‹¬ç”¨æˆ·å®šä¹‰çš„ï¼‰ï¼Œå…¶å®ƒæ–¹é¢å°±å¾—è‡ªå·±ä¿è¯äº†ã€‚å‰é¢çš„å†…å®¹ä¹Ÿéƒ½æåˆ°äº†ã€‚</p><h2 id="çº¿ç¨‹å­˜å‚¨æœŸ" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹å­˜å‚¨æœŸ"><span>çº¿ç¨‹å­˜å‚¨æœŸ</span></a></h2>`,9),Ka=n("strong",null,"çº¿ç¨‹å­˜å‚¨æœŸ",-1),Na={href:"https://zh.wikipedia.org/wiki/%E7%BA%BF%E7%A8%8B%E5%B1%80%E9%83%A8%E5%AD%98%E5%82%A8",target:"_blank",rel:"noopener noreferrer"},Wa=n("em",null,"çº¿ç¨‹å±€éƒ¨å­˜å‚¨",-1),Ya={href:"https://zh.cppreference.com/w/cpp/keyword/thread_local",target:"_blank",rel:"noopener noreferrer"},Ja=n("strong",null,[n("code",null,"thread_local")],-1),Qa=o(`<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº† <code>thread_local</code> å…³é”®å­—çš„ä½¿ç”¨ï¼š</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code><span class="token keyword">int</span> global_counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">thread_local</span> <span class="token keyword">int</span> thread_local_counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">print_counters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;globalï¼š&quot;</span> <span class="token operator">&lt;&lt;</span> global_counter<span class="token operator">++</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;thread_localï¼š&quot;</span> <span class="token operator">&lt;&lt;</span> thread_local_counter<span class="token operator">++</span> <span class="token operator">&lt;&lt;</span> <span class="token char">&#39;\\n&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>thread<span class="token punctuation">{</span> print_counters <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread<span class="token punctuation">{</span> print_counters <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),Za={href:"https://godbolt.org/z/ncxTEce7f",target:"_blank",rel:"noopener noreferrer"},Ha=n("strong",null,"è¿è¡Œç»“æœ",-1),Ua=o(`<div class="language-txt line-numbers-mode" data-ext="txt" data-title="txt"><pre class="language-txt"><code>globalï¼š0
thread_localï¼š0
globalï¼š1
thread_localï¼š0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ®µä»£ç å¾ˆå¥½çš„å±•ç¤ºäº† <code>thread_local</code> å…³é”®å­—çš„ä½¿ç”¨ä»¥åŠå®ƒçš„ä½œç”¨ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ <code>thread_local_counter</code> å¯¹è±¡ï¼Œå®ƒä»¬ä¸æ˜¯åŒä¸€ä¸ªã€‚</p><hr><p>æˆ‘çŸ¥é“ä½ ä¼šæœ‰é—®é¢˜ï¼šâ€œé‚£ä¹ˆ C++11 ä¹‹å‰å‘¢ï¼Ÿâ€é‚£æ—¶å¼€å‘è€…é€šå¸¸ä½¿ç”¨ POSIX çº¿ç¨‹ï¼ˆPthreadsï¼‰æˆ– Win32 çº¿ç¨‹çš„æ¥å£ï¼Œæˆ–è€…ä¾èµ–å„å®¶ç¼–è¯‘å™¨çš„æ‰©å±•ã€‚ä¾‹å¦‚ï¼š</p>`,4),$a={href:"https://pubs.opengroup.org/onlinepubs/9699919799/",target:"_blank",rel:"noopener noreferrer"},nt=n("strong",null,"POSIX",-1),st=n("code",null,"pthread_key_t",-1),at=n("code",null,"pthread_key_create",-1),tt=n("code",null,"pthread_setspecific",-1),ot=n("code",null,"pthread_getspecific",-1),et=n("code",null,"pthread_key_delete",-1),pt=n("strong",null,"Win32",-1),ct={href:"https://learn.microsoft.com/zh-cn/windows/win32/procthread/using-thread-local-storage",target:"_blank",rel:"noopener noreferrer"},lt=n("code",null,"TlsAlloc",-1),ut=n("code",null,"TlsSetValue",-1),it=n("code",null,"TlsGetValue",-1),dt=n("code",null,"TlsFree",-1),rt=n("strong",null,"GCC",-1),kt={href:"https://gcc.gnu.org/onlinedocs/gcc/extensions-to-the-c-language-family/thread-local-storage.html",target:"_blank",rel:"noopener noreferrer"},vt=n("code",null,"__thread",-1),mt=n("strong",null,"MSVC",-1),_t={href:"https://learn.microsoft.com/zh-cn/cpp/cpp/thread?view=msvc-170",target:"_blank",rel:"noopener noreferrer"},bt=n("code",null,"__declspec(thread)",-1),ht=o(`<p>POSIX ä¸ Win32 æ¥å£çš„å°±ä¸å†ä»‹ç»äº†ï¼Œæœ‰å…´è¶£å‚è§æˆ‘ä»¬çš„é“¾æ¥å³å¯ã€‚æˆ‘ä»¬å°±æ‹¿å…ˆå‰çš„ä»£ç æ”¹æˆä½¿ç”¨ GCC ä¸ MSVC çš„ç¼–è¯‘å™¨æ‰©å±•å³å¯ã€‚</p><div class="language-cpp line-numbers-mode" data-ext="cpp" data-title="cpp"><pre class="language-cpp"><code>__thread <span class="token keyword">int</span> thread_local_counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>           <span class="token comment">// GCC</span>
<span class="token function">__declspec</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span> <span class="token keyword">int</span> thread_local_counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// MSVC</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,2),gt=n("code",null,"__thread",-1),ft=n("code",null,"__declspec(thread)",-1),wt={href:"https://clang.llvm.org/docs/ClangCommandLineReference.html#cmdoption-clang-fms-extensions",target:"_blank",rel:"noopener noreferrer"},xt=n("code",null,"-fms-extensions",-1),yt={href:"https://godbolt.org/z/eMz8Yz3hv",target:"_blank",rel:"noopener noreferrer"},Et=n("strong",null,[n("code",null,"__declspec(thread)"),s(" è¿è¡Œæµ‹è¯•")],-1),qt={href:"https://godbolt.org/z/Wx6zKhK44",target:"_blank",rel:"noopener noreferrer"},zt=n("strong",null,[n("code",null,"__thread"),s(" è¿è¡Œæµ‹è¯•")],-1),Bt=o('<p>è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ‰©å±•å¹¶ä¸æ˜¯æ ‡å‡†çš„ C++ è¯­è¨€ç‰¹æ€§ï¼Œå®ƒä»¬çš„è·¨å¹³å°æ€§å’Œå¯ç§»æ¤æ€§è¾ƒå·®ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ C++ æ ‡å‡†çš„ <code>thread_local</code>ã€‚</p><p>äº†è§£å…¶å®ƒ API ä»¥åŠç¼–è¯‘å™¨æ‰©å±•æœ‰åŠ©äºç†è§£å†å²ä¸Šçº¿ç¨‹å­˜å‚¨æœŸçš„æ¼”è¿›ã€‚åŒæ—¶æ‰©å±•çŸ¥è¯†é¢ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>æœ¬ç« è®¨è®ºäº†å¤šçº¿ç¨‹çš„å…±äº«æ•°æ®å¼•å‘çš„æ¶æ€§æ¡ä»¶ç«äº‰ä¼šå¸¦æ¥çš„é—®é¢˜ã€‚å¹¶è¯´æ˜äº†å¯ä»¥ä½¿ç”¨äº’æ–¥é‡ï¼ˆ<code>std::mutex</code>ï¼‰ä¿æŠ¤å…±äº«æ•°æ®ï¼Œå¹¶ä¸”è¦æ³¨æ„äº’æ–¥é‡ä¸Šé”çš„â€œ<strong>ç²’åº¦</strong>â€ã€‚C++æ ‡å‡†åº“æä¾›äº†å¾ˆå¤šå·¥å…·ï¼ŒåŒ…æ‹¬ç®¡ç†äº’æ–¥é‡çš„ç®¡ç†ç±»ï¼ˆ<code>std::lock_guard</code>ï¼‰ï¼Œä½†æ˜¯äº’æ–¥é‡åªèƒ½è§£å†³å®ƒèƒ½è§£å†³çš„é—®é¢˜ï¼Œå¹¶ä¸”å®ƒæœ‰è‡ªå·±çš„é—®é¢˜ï¼ˆ<strong>æ­»é”</strong>ï¼‰ã€‚åŒæ—¶æˆ‘ä»¬è®²è¿°äº†ä¸€äº›é¿å…æ­»é”çš„æ–¹æ³•å’ŒæŠ€æœ¯ã€‚è¿˜è®²äº†ä¸€ä¸‹äº’æ–¥é‡æ‰€æœ‰æƒè½¬ç§»ã€‚ç„¶åè®¨è®ºäº†é¢å¯¹ä¸åŒæƒ…å†µä¿æŠ¤å…±äº«æ•°æ®çš„ä¸åŒæ–¹å¼ï¼Œä½¿ç”¨ <code>std::call_once()</code> ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½¿ç”¨è¯»å†™é”ï¼ˆ<code>std::shared_mutex</code>ï¼‰ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„ã€‚ä»¥åŠç‰¹æ®Šæƒ…å†µå¯èƒ½ç”¨åˆ°çš„äº’æ–¥é‡ <code>recursive_mutex</code>ï¼Œæœ‰äº›äººå¯èƒ½å–œæ¬¢ç§°ä½œï¼š<strong>é€’å½’é”</strong>ã€‚æœ€åèŠäº†ä¸€ä¸‹ <code>new</code>ã€<code>delete</code> è¿ç®—ç¬¦çš„åº“å‡½æ•°å®é™…æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»¥åŠçº¿ç¨‹å­˜å‚¨æœŸã€‚</p>',4),At={href:"https://zh.cppreference.com/w/cpp/thread#.E6.9C.AA.E6.9D.A5.E4.BD.93",target:"_blank",rel:"noopener noreferrer"},Ct=n("strong",null,"Futures",-1),Mt={href:"https://zh.cppreference.com/w/cpp/thread#.E6.9D.A1.E4.BB.B6.E5.8F.98.E9.87.8F",target:"_blank",rel:"noopener noreferrer"},Dt=n("strong",null,"æ¡ä»¶å˜é‡",-1),Tt=n("hr",{class:"footnotes-sep"},null,-1),Ot={class:"footnotes"},jt={class:"footnotes-list"},St={id:"footnote1",class:"footnote-item"},Lt={href:"https://zh.wikipedia.org/wiki/%E8%87%A8%E7%95%8C%E5%8D%80%E6%AE%B5",target:"_blank",rel:"noopener noreferrer"},Xt=n("a",{href:"#footnote-ref1",class:"footnote-backref"},"â†©ï¸",-1);function Ft(Pt,Vt){const t=e("ExternalLinkIcon"),p=e("RouteLink");return l(),u("div",null,[r,n("blockquote",null,[n("p",null,[n("a",k,[v,a(t)]),s(" çš„ operator<< è°ƒç”¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸ä¼šè¢«æ‰“æ–­ã€‚å³ï¼š"),m])]),_,n("p",null,[s("è€Œä¸”å³ä½¿ä¸æ˜¯ä¸€ä¸ªæ·»åŠ å…ƒç´ ï¼Œä¸€ä¸ªåˆ é™¤å…ƒç´ ï¼Œå…¨æ˜¯ "),b,s(" æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸€æ ·ä¼šæœ‰é—®é¢˜ï¼Œç”±äº std::vector ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼Œå› æ­¤å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å¹¶ä¿®æ”¹ v æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿ"),n("a",h,[g,a(t)]),s("ã€‚å…·ä½“æ¥è¯´ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å°è¯•å‘ v ä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œä½†æ˜¯ "),f,s(" å‡½æ•°å´æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œæ‰§è¡Œäº†ä¸€åŠï¼Œåˆå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ã€‚å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ç«äº‰ï¼Œä»è€Œå¼•å‘"),w,s("çš„ç»“æœã€‚")]),x,n("p",null,[s("æ ‡é‡ç±»å‹ç­‰éƒ½åŒç†ï¼Œæœ‰"),y,s("ï¼Œ"),n("a",E,[q,a(t)]),s("ï¼š")]),z,n("p",null,[s("è¿™æ®µä»£ç ä½ å¤šæ¬¡"),n("a",B,[s("è¿è¡Œ"),a(t)]),s("å®ƒä¼šå¾—åˆ°æ¯«æ— è§„å¾‹å’Œæ ¼å¼çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨"),n("a",A,[s("äº’æ–¥é‡"),a(t)]),s("è§£å†³è¿™ä¸ªé—®é¢˜ï¼š")]),C,n("p",null,[s("ä¸è¿‡ä¸€èˆ¬ä¸æ¨èè¿™æ ·æ˜¾å¼çš„ "),M,s(" ä¸ "),D,s("ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ C++11 æ ‡å‡†åº“å¼•å…¥çš„â€œç®¡ç†ç±»â€ "),n("a",T,[O,a(t)]),s("ï¼š")]),j,n("p",null,[s("é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ"),S,s(" æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿå®ƒæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿé¦–å…ˆé¡¾åæ€ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œç®¡ç†ç±»â€æ¨¡æ¿ï¼Œç”¨æ¥ç®¡ç†äº’æ–¥é‡çš„ä¸Šé”ä¸è§£é”ï¼Œæˆ‘ä»¬æ¥çœ‹å®ƒåœ¨ "),n("a",L,[s("MSVC STL"),a(t)]),s(" çš„å®ç°ï¼š")]),X,n("p",null,[s("è¿™æ®µä»£ç æå…¶ç®€å•ï¼Œé¦–å…ˆç®¡ç†ç±»ï¼Œè‡ªç„¶ä¸å¯ç§»åŠ¨ä¸å¯å¤åˆ¶ï¼Œæˆ‘ä»¬å®šä¹‰å¤åˆ¶æ„é€ ä¸å¤åˆ¶èµ‹å€¼ä¸º"),n("a",F,[s("å¼ƒç½®å‡½æ•°"),a(t)]),s("ï¼ŒåŒæ—¶"),n("a",P,[s("é˜»æ­¢"),a(t)]),s("äº†ç§»åŠ¨ç­‰å‡½æ•°çš„éšå¼å®šä¹‰ã€‚")]),V,I,n("p",null,[s("åŒæ—¶å®ƒè¿˜æä¾›ä¸€ä¸ªæœ‰é¢å¤–"),n("a",G,[R,a(t)]),s("å‚æ•°çš„æ„é€ å‡½æ•° ï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™æ„é€ å‡½æ•°ä¸ä¼šä¸Šé”ã€‚")]),K,n("blockquote",null,[n("p",null,[s("å®Œæ•´"),n("a",N,[s("ä»£ç æµ‹è¯•"),a(t)]),s("ã€‚")])]),W,n("p",null,[s("C++17 æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œ"),n("a",Y,[s("ç±»æ¨¡æ¿å®å‚æ¨å¯¼"),a(t)]),s("ï¼Œ "),J,s(" å¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°è‡ªè¡Œæ¨å¯¼ï¼Œè€Œä¸éœ€è¦å†™æ˜æ¨¡æ¿ç±»å‹å‚æ•°ï¼š")]),Q,n("p",null,[s("å¹¶ä¸” C++17 è¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„â€œç®¡ç†ç±»â€ï¼š"),n("a",Z,[H,a(t)]),s("ï¼Œå®ƒç›¸è¾ƒäº "),U,s("çš„åŒºåˆ«åœ¨äºï¼Œ"),$,s("ã€‚ä¸è¿‡å¯¹äºå¤„ç†ä¸€ä¸ªäº’æ–¥é‡çš„æƒ…å†µï¼Œå®ƒå’Œ "),nn,s(" å‡ ä¹å®Œå…¨ç›¸åŒã€‚")]),sn,n("p",null,[s("å¯èƒ½çš„"),n("a",an,[tn,a(t)]),s("ï¼š")]),on,n("blockquote",null,[n("p",null,[s("ç®€è€Œè¨€ä¹‹ï¼Œæœ‰å¯èƒ½å‡½æ•° f é”å®šäº† m1ï¼Œå‡½æ•° f2 é”å®šäº† m2ï¼Œå‡½æ•° f è¦å¾€ä¸‹æ‰§è¡Œï¼Œç»™ m2 ä¸Šé”ï¼Œæ‰€ä»¥åœ¨ç­‰å¾… f2 è§£é” m2ï¼Œç„¶è€Œå‡½æ•° f2 ä¹Ÿåœ¨ç­‰å¾…å‡½æ•° f è§£é” m1 å®ƒæ‰èƒ½å¾€ä¸‹æ‰§è¡Œã€‚æ‰€ä»¥æ­»é”ã€‚"),n("a",en,[s("æµ‹è¯•ä»£ç "),a(t)]),s("ã€‚")])]),pn,n("blockquote",null,[n("p",null,[s("å®Œå…¨å¯èƒ½çº¿ç¨‹ A æ‰§è¡Œ 1 çš„æ—¶å€™ä¸Šé”äº† a çš„äº’æ–¥é‡ï¼Œçº¿ç¨‹ B æ‰§è¡Œ "),cn,s(" ä¸Šé”äº† b çš„äº’æ–¥é‡ã€‚çº¿ç¨‹ A å¾€ä¸‹æ‰§è¡Œéœ€è¦ä¸Šé” b çš„äº’æ–¥é‡ï¼Œçº¿ç¨‹ B åˆ™è¦ä¸Šé” a çš„äº’æ–¥é‡æ‰§è¡Œå®Œæ¯•æ‰èƒ½è§£é”ï¼Œå“ªä¸ªéƒ½æ²¡åŠæ³•å¾€ä¸‹æ‰§è¡Œï¼Œ"),ln,s("ã€‚"),n("a",un,[s("æµ‹è¯•ä»£ç "),a(t)]),s("ã€‚")])]),dn,n("p",null,[s("C++ æ ‡å‡†åº“æœ‰å¾ˆå¤šåŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ"),n("strong",null,[s("å¯ä»¥ä½¿ç”¨ "),n("a",rn,[kn,a(t)])]),s(" ï¼Œå®ƒèƒ½ä¸€æ¬¡æ€§é”ä½å¤šä¸ªäº’æ–¥é‡ï¼Œå¹¶ä¸”æ²¡æœ‰æ­»é”é£é™©ã€‚ä¿®æ”¹ swap ä»£ç åå¦‚ä¸‹ï¼š")]),vn,n("p",null,[s("C++17 æ–°å¢äº† "),n("a",mn,[_n,a(t)]),s(" ï¼Œæä¾›æ­¤å‡½æ•°çš„ "),n("a",bn,[s("RAII"),a(t)]),s(" åŒ…è£…ï¼Œé€šå¸¸å®ƒæ¯”è£¸è°ƒç”¨ "),hn,s(" æ›´å¥½ã€‚")]),gn,n("p",null,[s("å¯¹æ­¤ç±»æœ‰å…´è¶£æˆ–ä»»ä½•ç–‘é—®ï¼Œå»ºè®®é˜…è¯»"),a(p,{to:"/md/%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90/02scoped_lock%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html"},{default:i(()=>[fn]),_:1})]),wn,n("p",null,[n("a",xn,[yn,a(t)]),s(" æ˜¯ C++11 å¼•å…¥çš„ä¸€ç§é€šç”¨äº’æ–¥åŒ…è£…å™¨ï¼Œå®ƒç›¸æ¯”äº "),En,s(" æ›´åŠ çš„çµæ´»ã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿæ›´åŠ çš„å¤æ‚ï¼Œå°¤å…¶å®ƒè¿˜å¯ä»¥ä¸æˆ‘ä»¬ä¸‹ä¸€ç« è¦è®²çš„"),n("a",qn,[s("æ¡ä»¶å˜é‡"),a(t)]),s("ä¸€èµ·ä½¿ç”¨ã€‚ä½¿ç”¨å®ƒå¯ä»¥å°†ä¹‹å‰ä½¿ç”¨ "),zn,s(" çš„ "),Bn,s(" æ”¹å†™ä¸€ä¸‹ï¼š")]),An,n("p",null,[s("è§£é‡Šè¿™æ®µä»£ç æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ç›´æ¥å±•ç¤ºæ ‡å‡†åº“çš„æºç ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£ "),Cn,s(" æ˜¯â€œä¸è·å¾—äº’æ–¥ä½“çš„æ‰€æœ‰æƒâ€ã€‚æ²¡æœ‰æ‰€æœ‰æƒè‡ªç„¶æ„é€ å‡½æ•°å°±ä¸ä¼šä¸Šé”ï¼Œä½†ä¸æ­¢å¦‚æ­¤ã€‚æˆ‘ä»¬è¿˜è¦å…ˆçŸ¥é“ std::unique_lock ä¿æœ‰çš„æ•°æ®æˆå‘˜ï¼ˆéƒ½ä»¥ "),n("a",Mn,[s("MSVC STL"),a(t)]),s(" ä¸ºä¾‹ï¼‰ï¼š")]),Dn,n("p",null,[s("å¦‚ä½ æ‰€è§ï¼Œåªæ˜¯åˆå§‹åŒ–äº†æ•°æ®æˆå‘˜è€Œå·²ï¼Œæ³¨æ„ï¼Œ"),Tn,s("ã€‚å¹¶ä¸” "),On,s(" æ˜¯æœ‰ "),n("a",jn,[Sn,a(t)]),s(" ã€"),n("a",Ln,[Xn,a(t)]),s(" ã€"),n("a",Fn,[Pn,a(t)]),s(" æˆå‘˜å‡½æ•°çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä¼ é€’ç»™ "),Vn,s("ã€ è¿›è¡Œè°ƒç”¨ã€‚è¿™é‡Œè¿˜éœ€è¦æä¸€ä¸‹ "),In,s(" æˆå‘˜å‡½æ•°çš„ä»£ç ï¼š")]),Gn,n("p",null,[s("è¿™æ®µä»£ç è¿è¡Œä¼š"),n("a",Rn,[s("æŠ›å‡ºå¼‚å¸¸"),a(t)]),s("ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå› ä¸º "),Kn,s(" åªæ˜¯ä¸ä¸Šé”ï¼Œä½†æ˜¯"),Nn,s("ï¼Œå³ "),Wn,s(" è®¾ç½®ä¸º "),Yn,s(" äº†ï¼Œå½“è¿è¡Œ "),Jn,s(" æˆå‘˜å‡½æ•°çš„æ—¶å€™ï¼Œè°ƒç”¨äº† "),Qn,s(" è¿›è¡Œæ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯ï¼š")]),Zn,n("p",null,[s("æ»¡è¶³ç¬¬äºŒä¸ª ifï¼Œå› ä¸º "),Hn,s(" ä¸º "),Un,s(" æ‰€ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ«çš„æ ‡å‡†åº“ä¹Ÿéƒ½æœ‰"),n("a",$n,[s("ç±»ä¼¼è®¾è®¡"),a(t)]),s("ã€‚å¾ˆè¯¡å¼‚çš„è®¾è®¡å¯¹å§ï¼Œæ­£å¸¸ã€‚é™¤éæˆ‘ä»¬å†™æˆï¼š")]),ns,n("p",null,[s("é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ï¼Œäº’æ–¥é‡æ»¡è¶³"),n("a",ss,[as,a(t)]),s("çš„è¦æ±‚ï¼Œ"),ts,s("ã€‚æ‰€è°“çš„åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡ï¼Œå…¶å®åªæ˜¯ä¼ é€’äº†å®ƒä»¬çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ç½¢äº†ã€‚å¯ä»¥åˆ©ç”¨å„ç§ç±»æ¥è¿›è¡Œä¼ é€’ï¼Œæ¯”å¦‚å‰é¢æåˆ°çš„ "),os,s("ã€‚")]),n("p",null,[es,s(" å¯ä»¥è·å–äº’æ–¥é‡çš„æ‰€æœ‰æƒï¼Œè€Œäº’æ–¥é‡çš„æ‰€æœ‰æƒå¯ä»¥é€šè¿‡ç§»åŠ¨æ“ä½œè½¬ç§»ç»™å…¶ä»–çš„ "),ps,s(" å¯¹è±¡ã€‚æœ‰äº›æ—¶å€™ï¼Œè¿™ç§è½¬ç§»ï¼ˆ"),cs,s("ï¼‰æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„ï¼Œæ¯”å¦‚å½“"),n("a",ls,[s("å‡½æ•°è¿”å›"),a(t)]),s(),us,s(" å¯¹è±¡ã€‚å¦ä¸€ç§æƒ…å†µå°±æ˜¯å¾—æ˜¾å¼ä½¿ç”¨ "),n("a",is,[ds,a(t)]),s("ã€‚")]),rs,n("p",null,[s("æˆ‘ç›¸ä¿¡ä½ å¯èƒ½å¯¹ "),ks,s(" æœ‰ç–‘é—®ï¼Œå…¶å®ä¸ç”¨æ„Ÿåˆ°å¥‡æ€ªï¼Œè¿™æ˜¯ä¸€ä¸ªäº’æ–¥é‡çš„å£°æ˜ï¼Œå¯èƒ½åˆ«çš„ç¿»è¯‘å•å…ƒï¼ˆæˆ– dll ç­‰ï¼‰æœ‰å®ƒçš„å®šä¹‰ï¼ŒæˆåŠŸé“¾æ¥ä¸Šã€‚æˆ‘ä»¬å‰é¢ä¹Ÿè¯´äº†ï¼šâ€œ"),vs,s("â€ï¼Œæ‰€ä»¥"),n("strong",null,[s("è¦ç‰¹åˆ«æ³¨æ„äº’æ–¥é‡çš„"),n("a",ms,[s("ç”Ÿå­˜æœŸ"),a(t)])]),s("ã€‚")]),n("blockquote",null,[n("p",null,[s("extern è¯´æ˜ç¬¦åªèƒ½æ­é…å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜ï¼ˆé™¤äº†ç±»æˆå‘˜æˆ–å‡½æ•°å½¢å‚ï¼‰ã€‚"),n("em",null,[s("å®ƒæŒ‡å®šå¤–éƒ¨é“¾æ¥ï¼Œè€Œä¸”æŠ€æœ¯ä¸Šä¸å½±å“å­˜å‚¨æœŸï¼Œä½†å®ƒä¸èƒ½ç”¨æ¥å®šä¹‰è‡ªåŠ¨å­˜å‚¨æœŸçš„å¯¹è±¡ï¼Œæ•…æ‰€æœ‰ extern å¯¹è±¡éƒ½å…·æœ‰"),n("strong",null,[s("é™æ€æˆ–çº¿ç¨‹"),n("a",_s,[s("å­˜å‚¨æœŸ"),a(t)]),s("ã€‚")])])])]),bs,n("blockquote",null,[n("p",null,[s("ä¸¾ä¸€ä¸ªä½¿ç”¨ "),hs,s(" çš„å®Œæ•´"),n("a",gs,[s("è¿è¡Œç¤ºä¾‹"),a(t)]),s("ã€‚å½“ç„¶ï¼Œå…¶å®ç†è®ºä¸Šä½  "),fs,s(" ä¹Ÿæ˜¯å®Œå…¨å¯è¡Œ...... ğŸ¤£ğŸ¤£")])]),ws,n("ol",null,[xs,n("li",null,[n("p",null,[s("C++ æ ‡å‡†å§”å‘˜ä¼šä¹Ÿè®¤ä¸ºå¤„ç†æ­¤é—®é¢˜å¾ˆé‡è¦ï¼Œ"),n("strong",null,[s("æ‰€ä»¥æ ‡å‡†åº“æä¾›äº† "),n("a",ys,[Es,a(t)]),s(" å’Œ "),n("a",qs,[zs,a(t)])]),s(" æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚æ¯”èµ·é”ä½äº’æ–¥é‡å¹¶æ˜¾å¼æ£€æŸ¥æŒ‡é’ˆï¼Œæ¯ä¸ªçº¿ç¨‹åªéœ€è¦ä½¿ç”¨ "),Bs,s(" å°±å¯ä»¥ã€‚"),As,s("ã€‚")]),Cs,n("p",null,[s("ä»¥ä¸Šä»£ç  "),Ms,s(" å¯¹è±¡æ˜¯å…¨å±€å‘½åç©ºé—´ä½œç”¨åŸŸå£°æ˜ï¼Œå¦‚æœä½ æœ‰éœ€è¦ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¯ç±»çš„æˆå‘˜ã€‚ç”¨äºæ­é… "),Ds,s(" ä½¿ç”¨ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨çš„"),Ts,s("åˆå§‹åŒ–ã€‚"),Os,s(" åªéœ€è¦æ¥å—"),n("a",js,[Ss,a(t)]),s("å¯¹è±¡å³å¯ï¼Œä¹Ÿä¸è¦æ±‚ä¸€å®šæ˜¯å‡½æ•°ã€‚")]),n("blockquote",null,[Ls,n("p",null,[n("a",Xs,[s("æµ‹è¯•é“¾æ¥"),a(t)]),s("ã€‚æ­£å¸¸æƒ…å†µä¼šä¿è¯ä¼ å…¥çš„å¯è°ƒç”¨å¯¹è±¡åªè°ƒç”¨ä¸€æ¬¡ï¼Œå³åˆå§‹åŒ–åªæœ‰ä¸€æ¬¡ã€‚å¼‚å¸¸ä¹‹ç±»çš„æ˜¯ä¾‹å¤–ã€‚")])])]),Fs]),Ps,Vs,Is,Gs,n("p",null,[s("ç„¶è€Œä½¿ç”¨ "),Rs,s(" çš„å¼€é”€æ˜¯è¿‡å¤§çš„ï¼Œå®ƒä¸ç®¡æœ‰æ²¡æœ‰å‘ç”Ÿæ•°æ®ç«äº‰ï¼ˆä¹Ÿå°±æ˜¯å°±ç®—å…¨æ˜¯è¯»çš„æƒ…å†µï¼‰ä¹Ÿå¿…é¡»æ˜¯è€è€å®å®ä¸Šé”è§£é”ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œã€‚å¦‚æœä½ å­¦è¿‡å…¶å®ƒè¯­è¨€æˆ–è€…æ“ä½œç³»ç»Ÿï¼Œç›¸ä¿¡è¿™ä¸ªæ—¶å€™å°±å·²ç»æƒ³åˆ°äº†ï¼šâ€œ"),n("a",Ks,[Ns,a(t)]),s("â€ã€‚")]),n("p",null,[s("C++ æ ‡å‡†åº“è‡ªç„¶ä¸ºæˆ‘ä»¬æä¾›äº†ï¼š "),n("a",Ws,[Ys,a(t)]),s("ï¼ˆC++14ï¼‰ã€ "),n("a",Js,[Qs,a(t)]),s("ï¼ˆC++17ï¼‰ã€‚å®ƒä»¬çš„åŒºåˆ«ç®€å•æ¥è¯´ï¼Œå‰è€…æ”¯æŒæ›´å¤šçš„æ“ä½œæ–¹å¼ï¼Œåè€…æœ‰æ›´é«˜çš„æ€§èƒ½ä¼˜åŠ¿ã€‚")]),n("p",null,[Zs,s(" åŒæ ·æ”¯æŒ "),Hs,s("ã€"),Us,s("ã€‚å’Œ "),$s,s(" åšçš„ä¸€æ ·ï¼Œä¿è¯"),na,s("çš„ç‹¬å è®¿é—®ã€‚"),n("strong",null,[s("è€Œé‚£äº›æ— éœ€ä¿®æ”¹æ•°æ®ç»“æ„çš„"),sa,s("ï¼Œå¯ä»¥ä½¿ç”¨ "),n("a",aa,[ta,a(t)]),s(" è·å–è®¿é—®æƒ")]),s("ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·è¯»å–ã€‚")]),oa,n("blockquote",null,[n("p",null,[n("a",ea,[s("å®Œæ•´ä»£ç "),a(t)]),s("ã€‚"),n("a",pa,[s("æµ‹è¯•"),a(t)]),s("é“¾æ¥ã€‚æ ‡å‡†è¾“å‡ºå¯èƒ½äº¤é”™ï¼Œä½†æ— æ•°æ®ç«äº‰ã€‚")])]),ca,la,n("p",null,[s("çº¿ç¨‹å¯¹å·²ç»ä¸Šé”çš„ "),ua,s(" å†æ¬¡ä¸Šé”æ˜¯é”™è¯¯çš„ï¼Œè¿™æ˜¯"),n("a",ia,[da,a(t)]),s("ã€‚ç„¶è€Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹ä¼šå°è¯•åœ¨é‡Šæ”¾ä¸€ä¸ªäº’æ–¥é‡å‰å¤šæ¬¡è·å–ï¼Œæ‰€ä»¥æä¾›äº†"),ra,s("ã€‚")]),ka,n("blockquote",null,[n("p",null,[n("a",va,[s("è¿è¡Œ"),a(t)]),s("æµ‹è¯•ã€‚")])]),n("ul",null,[n("li",null,[n("p",null,[n("a",ma,[_a,a(t)]),s("ï¼šçº¿ç¨‹å¯ä»¥åœ¨é€’å½’äº’æ–¥ä½“ä¸Šé‡å¤è°ƒç”¨ "),ba,s("ã€‚åœ¨çº¿ç¨‹è°ƒç”¨ "),ha,s(" åŒ¹é…æ¬¡æ•°åï¼Œæ‰€æœ‰æƒæ‰ä¼šå¾—åˆ°"),ga,s("ã€‚")])]),n("li",null,[n("p",null,[n("a",fa,[wa,a(t)]),s("ï¼šè‹¥æ‰€æœ‰æƒå±‚æ•°ä¸º 1ï¼ˆæ­¤çº¿ç¨‹å¯¹ "),n("a",xa,[s("lock()"),a(t)]),s(" çš„è°ƒç”¨æ°å¥½æ¯” "),ya,s(" å¤šä¸€æ¬¡ ï¼‰åˆ™"),Ea,s("ï¼Œå¦åˆ™å°†æ‰€æœ‰æƒå±‚æ•°å‡å°‘ 1ã€‚")])])]),qa,n("blockquote",null,[n("p",null,[n("a",za,[s("è¿è¡Œ"),a(t)]),s("æµ‹è¯•ã€‚")])]),Ba,Aa,n("ul",null,[n("li",null,[n("a",Ca,[Ma,s(" è¿ç®—ç¬¦"),a(t)]),s("å’Œ "),n("a",Da,[Ta,s(" è¿ç®—ç¬¦"),a(t)]),s("çš„"),Oa,s("ç‰ˆæœ¬")]),ja,n("li",null,[n("a",Sa,[s("std::calloc"),a(t)]),s("ã€"),n("a",La,[s("std::malloc"),a(t)]),s("ã€"),n("a",Xa,[s("std::realloc"),a(t)]),s("ã€"),n("a",Fa,[s("std::aligned_alloc"),a(t)]),s(" (C++17 èµ·)ã€"),n("a",Pa,[s("std::free"),a(t)])])]),Va,n("blockquote",null,[n("p",null,[s("ä¸€ä¸ªç›´è§‚çš„å±•ç¤ºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ "),Ia,s("ï¼Œçœ‹åˆ°æ— åºçš„è¾“å‡ºï¼Œ"),n("a",Ga,[s("ä¾‹å­"),a(t)]),s("ã€‚")])]),Ra,n("p",null,[Ka,s("ï¼ˆä¹Ÿæœ‰äººå–œæ¬¢ç§°ä½œâ€œ"),n("a",Na,[Wa,a(t)]),s("â€ï¼‰çš„æ¦‚å¿µæºè‡ªæ“ä½œç³»ç»Ÿï¼Œæ˜¯ä¸€ç§éå¸¸å¤è€çš„æœºåˆ¶ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§ç¼–ç¨‹è¯­è¨€ã€‚çº¿ç¨‹å­˜å‚¨æœŸçš„å¯¹è±¡åœ¨çº¿ç¨‹å¼€å§‹æ—¶åˆ†é…ï¼Œå¹¶åœ¨çº¿ç¨‹ç»“æŸæ—¶é‡Šæ”¾ã€‚æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å¯¹è±¡å®ä¾‹ï¼Œäº’ä¸å¹²æ‰°ã€‚åœ¨ C++11ä¸­ï¼Œå¼•å…¥äº†"),n("a",Ya,[Ja,a(t)]),s("å…³é”®å­—ï¼Œç”¨äºå£°æ˜å…·æœ‰çº¿ç¨‹å­˜å‚¨æœŸçš„å¯¹è±¡ã€‚")]),Qa,n("p",null,[n("a",Za,[Ha,a(t)]),s("ï¼š")]),Ua,n("ul",null,[n("li",null,[n("a",$a,[nt,a(t)]),s("ï¼šä½¿ç”¨ "),st,s(" å’Œç›¸å…³çš„å‡½æ•°ï¼ˆ "),at,s("ã€"),tt,s("ã€"),ot,s(" å’Œ"),et,s("ï¼‰æ¥ç®¡ç†çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€‚")]),n("li",null,[pt,s("ï¼šä½¿ç”¨ "),n("a",ct,[s("TLSï¼ˆThread Local Storageï¼‰"),a(t)]),s("æœºåˆ¶ï¼Œé€šè¿‡å‡½æ•° "),lt,s("ã€"),ut,s("ã€"),it,s(" å’Œ "),dt,s(" æ¥å®ç°çº¿ç¨‹å±€éƒ¨å­˜å‚¨ã€‚")]),n("li",null,[rt,s("ï¼šä½¿ç”¨ "),n("a",kt,[vt,a(t)]),s(" ã€‚")]),n("li",null,[mt,s("ï¼šä½¿ç”¨ "),n("a",_t,[bt,a(t)]),s("ã€‚")])]),ht,n("p",null,[s("MSVC æ— æ³•ä½¿ç”¨ GCC çš„ç¼–è¯‘å™¨æ‰©å±•ï¼ŒGCC ä¹Ÿè‚¯å®šæ— æ³•ä½¿ç”¨ MSVC çš„æ‰©å±•ï¼Œä¸è¿‡ Clang ç¼–è¯‘å™¨å¯ä»¥ï¼Œå®ƒæ”¯æŒ "),gt,s(" ä¸ "),ft,s(" ä¸¤ç§ã€‚Clang é»˜è®¤æƒ…å†µå°±æ”¯æŒ GCC çš„ç¼–è¯‘å™¨æ‰©å±•ï¼Œå¦‚æœè¦æ”¯æŒ MSVCï¼Œéœ€è¦è®¾ç½® "),n("a",wt,[xt,a(t)]),s(" ç¼–è¯‘é€‰é¡¹ã€‚")]),n("ul",null,[n("li",null,[n("a",yt,[Et,a(t)])]),n("li",null,[n("a",qt,[zt,a(t)])])]),Bt,n("p",null,[s("ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å¼€å§‹è®²è¿°åŒæ­¥æ“ä½œï¼Œä¼šä½¿ç”¨åˆ° "),n("a",At,[Ct,a(t)]),s("ã€"),n("a",Mt,[Dt,a(t)]),s("ç­‰è®¾æ–½ã€‚")]),Tt,n("section",Ot,[n("ol",jt,[n("li",St,[n("p",null,[s('"'),n("em",null,[n("strong",null,[n("a",Lt,[s("ä¸´ç•ŒåŒº"),a(t)])])]),s('"æŒ‡çš„æ˜¯ä¸€ä¸ªè®¿é—®å…±äº«èµ„æºçš„ç¨‹åºç‰‡æ®µï¼Œè€Œè¿™äº›å…±äº«èµ„æºåˆæ— æ³•åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®çš„ç‰¹æ€§ã€‚åœ¨ä¸´ç•ŒåŒºä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦è®²çš„äº’æ–¥é‡ï¼ˆMutexï¼‰ã€‚ '),Xt])])])])])}const Rt=c(d,[["render",Ft],["__file","03å…±äº«æ•°æ®.html.vue"]]),Kt=JSON.parse('{"path":"/md/03%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE.html","title":"å…±äº«æ•°æ®","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"æ¡ä»¶ç«äº‰","slug":"æ¡ä»¶ç«äº‰","link":"#æ¡ä»¶ç«äº‰","children":[]},{"level":2,"title":"ä½¿ç”¨äº’æ–¥é‡","slug":"ä½¿ç”¨äº’æ–¥é‡","link":"#ä½¿ç”¨äº’æ–¥é‡","children":[{"level":3,"title":"std::lock_guard","slug":"std-lock-guard","link":"#std-lock-guard","children":[]},{"level":3,"title":"try_lock","slug":"try-lock","link":"#try-lock","children":[]}]},{"level":2,"title":"ä¿æŠ¤å…±äº«æ•°æ®","slug":"ä¿æŠ¤å…±äº«æ•°æ®","link":"#ä¿æŠ¤å…±äº«æ•°æ®","children":[]},{"level":2,"title":"æ­»é”ï¼šé—®é¢˜ä¸è§£å†³","slug":"æ­»é”-é—®é¢˜ä¸è§£å†³","link":"#æ­»é”-é—®é¢˜ä¸è§£å†³","children":[]},{"level":2,"title":"std::unique_lock çµæ´»çš„é”","slug":"std-unique-lock-çµæ´»çš„é”","link":"#std-unique-lock-çµæ´»çš„é”","children":[]},{"level":2,"title":"åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡","slug":"åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡","link":"#åœ¨ä¸åŒä½œç”¨åŸŸä¼ é€’äº’æ–¥é‡","children":[]},{"level":2,"title":"ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹","slug":"ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹","link":"#ä¿æŠ¤å…±äº«æ•°æ®çš„åˆå§‹åŒ–è¿‡ç¨‹","children":[]},{"level":2,"title":"ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„","slug":"ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„","link":"#ä¿æŠ¤ä¸å¸¸æ›´æ–°çš„æ•°æ®ç»“æ„","children":[]},{"level":2,"title":"std::recursive_mutex","slug":"std-recursive-mutex","link":"#std-recursive-mutex","children":[]},{"level":2,"title":"newã€delete æ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ","slug":"newã€delete-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—","link":"#newã€delete-æ˜¯çº¿ç¨‹å®‰å…¨çš„å—","children":[]},{"level":2,"title":"çº¿ç¨‹å­˜å‚¨æœŸ","slug":"çº¿ç¨‹å­˜å‚¨æœŸ","link":"#çº¿ç¨‹å­˜å‚¨æœŸ","children":[]},{"level":2,"title":"æ€»ç»“","slug":"æ€»ç»“","link":"#æ€»ç»“","children":[]}],"git":{"createdTime":1710730998000,"updatedTime":1716626910000,"contributors":[{"name":"å½’æ•…é‡Œ","email":"3326284481@qq.com","commits":28},{"name":"mqç™½","email":"3326284481@qq.com","commits":4},{"name":"A. Jiang","email":"de34@live.cn","commits":3},{"name":"LeeZQXML","email":"2919625053@qq.com","commits":2}]},"readingTime":{"minutes":34.21,"words":10263},"filePathRelative":"md/03å…±äº«æ•°æ®.md","localizedDate":"2024å¹´3æœˆ18æ—¥","excerpt":"\\n<p>æœ¬ç« èŠ‚ä¸»è¦å†…å®¹ï¼š</p>\\n<ul>\\n<li>\\n<p>å¤šçº¿ç¨‹å…±äº«æ•°æ®çš„é—®é¢˜</p>\\n</li>\\n<li>\\n<p>ä½¿ç”¨äº’æ–¥é‡ä¿æŠ¤å…±äº«æ•°æ®</p>\\n</li>\\n<li>\\n<p>ä¿æŠ¤å…±äº«æ•°æ®çš„å…¶å®ƒæ–¹æ¡ˆ</p>\\n</li>\\n</ul>\\n<p>åœ¨ä¸Šä¸€ç« å†…å®¹ï¼Œæˆ‘ä»¬å¯¹äºçº¿ç¨‹çš„åŸºæœ¬ä½¿ç”¨å’Œç®¡ç†ï¼Œå¯ä»¥è¯´å·²ç»æ¯”è¾ƒäº†è§£äº†ï¼Œç”šè‡³æ·±å…¥é˜…è¯»äº†éƒ¨åˆ†çš„ <code>std::thread</code> æºç ã€‚æ‰€ä»¥å¦‚æœä½ å¥½å¥½å­¦ä¹ äº†ä¸Šä¸€ç« ï¼Œæœ¬ç« ä¹Ÿå®Œå…¨ä¸ç”¨æ‹…å¿ƒã€‚</p>\\n<p>æˆ‘ä»¬æœ¬ç« ï¼Œå°±è¦å¼€å§‹èŠå…±äº«æ•°æ®çš„é‚£äº›äº‹ã€‚</p>\\n<h2>æ¡ä»¶ç«äº‰</h2>\\n<p>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æŠ¢ç€å®Œæˆè‡ªå·±çš„ä»»åŠ¡ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå³ä½¿ä¼šæ”¹å˜æ‰§è¡Œé¡ºåºï¼Œä¹Ÿæ˜¯è‰¯æ€§ç«äº‰ï¼Œè¿™æ˜¯æ— æ‰€è°“çš„ã€‚æ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹éƒ½è¦å¾€æ ‡å‡†è¾“å‡ºè¾“å‡ºä¸€æ®µå­—ç¬¦ï¼Œè°å…ˆè°åå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå¤ªå¤§å½±å“ã€‚</p>"}');export{Rt as comp,Kt as data};
